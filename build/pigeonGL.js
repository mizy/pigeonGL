!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):"object"==typeof exports?exports.PigeonGL=e(require("three")):t.PigeonGL=e(t.three)}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(e,n){e.exports=t},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(7),o=n(16);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?o(t):e}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var i=n(17);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){"use strict";n.r(e);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=function(){function t(e){o()(this,t),this.layers=[];for(var n in this._userConfig=e,e)this[n]=e[n]}return r()(t,[{key:"on",value:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}},{key:"fire",value:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n)for(var i=n.slice(0),o=0,a=i.length;o<a;o++)i[o].call(this,e)}}},{key:"off",value:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n)if(e){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}else this._listeners[t]=[]}}},{key:"initConfig",value:function(t){}},{key:"onAdd",value:function(t){this.pigeonMap=t}},{key:"update",value:function(){}},{key:"onRemove",value:function(){this._listeners&&(this._listeners=[])}},{key:"addLayer",value:function(t){t.id=++this._layerid,this.layers.push(t),t.onAdd(this)}},{key:"removeLayer",value:function(t){for(var e in this.layers)if(this.layers[e].id==t.id)return this.layers[e].onRemove(),void this.layers.splice(e,1)}},{key:"getLayerById",value:function(t){for(var e=0;e<this.layers.length;e++)if(this.layer.id===t)return layer}}]),t}();e.default=s},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=i=function(t){return n(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},i(e)}t.exports=i},function(t,e,n){"use strict";n.r(e),function(t){var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=(n(9),n(18)),c=function(){function e(n){o()(this,e),this.scope=n,this.map=n.map,this.camera=n.camera,this.active=!0,this.world=n.world||new t.Group,this.world.position.x=this.world.position.y=0,this.camera.matrixAutoUpdate=!1,this.update()}return r()(e,[{key:"update",value:function(t){this.map=Object.assign(this.map,t),this.initMapTransform(),this.updateCamera()}},{key:"listenMapChange",value:function(){this.update(this.map)}},{key:"initMapTransform",value:function(){var t={};t.width=this.map.width,t.height=this.map.height,t.zHeight=this.map.zHeight||0,t.x=this.map.center[0],t.y=this.map.center[1],t.z=this.map.center[2]||this.getZ(this.map.zoom),t._pitch=this.map.pitch*Math.PI/180||0,t.angle=this.map.rotation*Math.PI/180||0,this.map.transform=t}},{key:"getZ",value:function(t){return t}},{key:"setCenter",value:function(t){this.map.center=t,this.initMapTransform()}},{key:"setRotation",value:function(t){this.map.rotation=t,this.map.transform.angle=this.map.rotation*Math.PI/180}},{key:"setPitch",value:function(t){this.map.pitch=t,this.map.transform._pitch=this.map.pitch*Math.PI/180}},{key:"updateCamera",value:function(e){var n=Math.abs(this.map.transform.z)+this.map.transform.zHeight,i=this.map.fov||.6435011087932844,o=n,a=i/2,r=Math.PI/2+this.map.transform._pitch,c=Math.sin(a)*o/Math.sin(Math.PI-r-a),u=1.01*(Math.cos(Math.PI/2-this.map.transform._pitch)*c+o);this.camera.projectionMatrix=s.makePerspectiveMatrix(i,this.map.transform.width/this.map.transform.height,1,u);var l=new t.Matrix4,h=(new t.Matrix4).makeTranslation(0,0,n),p=(new t.Matrix4).makeRotationX(this.map.transform._pitch),d=(new t.Matrix4).makeRotationZ(this.map.transform.angle);l.premultiply(h).premultiply(p).premultiply(d),this.camera.matrixWorld.copy(l),this.world.position.x=-this.map.transform.x,this.world.position.y=-this.map.transform.y}}]),e}();e.default=c}.call(this,n(0))},function(t,e){var n=512*Math.pow(2,0);t.exports={WORLD_SIZE_RATIO:0,WORLD_SIZE:n,PROJECTION_WORLD_SIZE:n/(6378137*Math.PI)/2,MERCATOR_A:6378137,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_CIRCUMFERENCE:40075e3,DISTANCE:200}},function(t,e,n){var i=n(25),o=n(26),a=n(27);t.exports=function(t){return i(t)||o(t)||a()}},function(t,e,n){"use strict";n.r(e);var i=n(0),o={OrbitControls:n(12).default,MTLLoader:n(13).default,OBJLoader:n(14).default,Map:n(15).default,Layer:n(6).default,CameraControl:n(8).default,ThirdPersonView:n(19).default,MapControl:n(20).default,TextLayer:n(21).default,VRLayer:n(22).default,CloudPoints:n(23).default,Text:n(24).default};window.PigeonGL=o,window.THREE=i,e.default=o},function(t,e,n){"use strict";n.r(e),function(t){var i=n(0),o=function(e,n){var i,o,a,r,s;this.object=e,this.domElement=void 0!==n?n:document,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:t.MOUSE.LEFT,ZOOM:t.MOUSE.MIDDLE,PAN:t.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(u),c.update(),d=p.NONE},this.update=(i=new t.Vector3,o=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),a=o.clone().inverse(),r=new t.Vector3,s=new t.Quaternion,function(){var t=c.object.position;return i.copy(t).sub(c.target),i.applyQuaternion(o),f.setFromVector3(i),c.autoRotate&&d===p.NONE&&_(2*Math.PI/60/60*c.autoRotateSpeed),f.theta+=v.theta,f.phi+=v.phi,f.theta=Math.max(c.minAzimuthAngle,Math.min(c.maxAzimuthAngle,f.theta)),f.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=y,f.radius=Math.max(c.minDistance,Math.min(c.maxDistance,f.radius)),c.target.add(g),i.setFromSpherical(f),i.applyQuaternion(a),t.copy(c.target).add(i),c.object.lookAt(c.target),!0===c.enableDamping?(v.theta*=1-c.dampingFactor,v.phi*=1-c.dampingFactor):v.set(0,0,0),y=1,g.set(0,0,0),!!(b||r.distanceToSquared(c.object.position)>m||8*(1-s.dot(c.object.quaternion))>m)&&(c.dispatchEvent(u),r.copy(c.object.position),s.copy(c.object.quaternion),b=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",B,!1),c.domElement.removeEventListener("mousedown",V,!1),c.domElement.removeEventListener("wheel",N,!1),c.domElement.removeEventListener("touchstart",G,!1),c.domElement.removeEventListener("touchend",Y,!1),c.domElement.removeEventListener("touchmove",W,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",Z,!1)};var c=this,u={type:"change"},l={type:"start"},h={type:"end"},p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=p.NONE,m=1e-6,f=new t.Spherical,v=new t.Spherical,y=1,g=new t.Vector3,b=!1,x=new t.Vector2,w=new t.Vector2,M=new t.Vector2,k=new t.Vector2,E=new t.Vector2,O=new t.Vector2,P=new t.Vector2,j=new t.Vector2,L=new t.Vector2;function C(){return Math.pow(.95,c.zoomSpeed)}function _(t){v.theta-=t}function S(t){v.phi-=t}var T,A=(T=new t.Vector3,function(t,e){T.setFromMatrixColumn(e,0),T.multiplyScalar(-t),g.add(T)}),R=function(){var e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),g.add(e)}}(),z=function(){var e=new t.Vector3;return function(t,n){var i=c.domElement===document?c.domElement.body:c.domElement;if(c.object.isPerspectiveCamera){var o=c.object.position;e.copy(o).sub(c.target);var a=e.length();a*=Math.tan(c.object.fov/2*Math.PI/180),A(2*t*a/i.clientHeight,c.object.matrix),R(2*n*a/i.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(A(t*(c.object.right-c.object.left)/c.object.zoom/i.clientWidth,c.object.matrix),R(n*(c.object.top-c.object.bottom)/c.object.zoom/i.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function I(t){c.object.isPerspectiveCamera?y/=t:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*t)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function D(t){c.object.isPerspectiveCamera?y*=t:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/t)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function V(t){if(!1!==c.enabled){switch(t.preventDefault(),t.button){case c.mouseButtons.ORBIT:if(!1===c.enableRotate)return;!function(t){x.set(t.clientX,t.clientY)}(t),d=p.ROTATE;break;case c.mouseButtons.ZOOM:if(!1===c.enableZoom)return;!function(t){P.set(t.clientX,t.clientY)}(t),d=p.DOLLY;break;case c.mouseButtons.PAN:if(!1===c.enablePan)return;!function(t){k.set(t.clientX,t.clientY)}(t),d=p.PAN}d!==p.NONE&&(document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",U,!1),c.dispatchEvent(l))}}function F(t){if(!1!==c.enabled)switch(t.preventDefault(),d){case p.ROTATE:if(!1===c.enableRotate)return;!function(t){w.set(t.clientX,t.clientY),M.subVectors(w,x);var e=c.domElement===document?c.domElement.body:c.domElement;_(2*Math.PI*M.x/e.clientWidth*c.rotateSpeed),S(2*Math.PI*M.y/e.clientHeight*c.rotateSpeed),x.copy(w),c.update()}(t);break;case p.DOLLY:if(!1===c.enableZoom)return;!function(t){j.set(t.clientX,t.clientY),L.subVectors(j,P),L.y>0?I(C()):L.y<0&&D(C()),P.copy(j),c.update()}(t);break;case p.PAN:if(!1===c.enablePan)return;!function(t){E.set(t.clientX,t.clientY),O.subVectors(E,k),z(O.x,O.y),k.copy(E),c.update()}(t)}}function U(t){!1!==c.enabled&&(document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",U,!1),c.dispatchEvent(h),d=p.NONE)}function N(t){!1===c.enabled||!1===c.enableZoom||d!==p.NONE&&d!==p.ROTATE||(t.preventDefault(),t.stopPropagation(),c.dispatchEvent(l),function(t){t.deltaY<0?D(C()):t.deltaY>0&&I(C()),c.update()}(t),c.dispatchEvent(h))}function Z(t){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(t){switch(t.keyCode){case c.keys.UP:z(0,c.keyPanSpeed),c.update();break;case c.keys.BOTTOM:z(0,-c.keyPanSpeed),c.update();break;case c.keys.LEFT:z(c.keyPanSpeed,0),c.update();break;case c.keys.RIGHT:z(-c.keyPanSpeed,0),c.update()}}(t)}function G(t){if(!1!==c.enabled){switch(t.touches.length){case 1:if(!1===c.enableRotate)return;!function(t){x.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=p.TOUCH_ROTATE;break;case 2:if(!1===c.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);P.set(0,i)}(t),d=p.TOUCH_DOLLY;break;case 3:if(!1===c.enablePan)return;!function(t){k.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=p.TOUCH_PAN;break;default:d=p.NONE}d!==p.NONE&&c.dispatchEvent(l)}}function W(t){if(!1!==c.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===c.enableRotate)return;if(d!==p.TOUCH_ROTATE)return;!function(t){w.set(t.touches[0].pageX,t.touches[0].pageY),M.subVectors(w,x);var e=c.domElement===document?c.domElement.body:c.domElement;_(2*Math.PI*M.x/e.clientWidth*c.rotateSpeed),S(2*Math.PI*M.y/e.clientHeight*c.rotateSpeed),x.copy(w),c.update()}(t);break;case 2:if(!1===c.enableZoom)return;if(d!==p.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);j.set(0,i),L.subVectors(j,P),L.y>0?D(C()):L.y<0&&I(C()),P.copy(j),c.update()}(t);break;case 3:if(!1===c.enablePan)return;if(d!==p.TOUCH_PAN)return;!function(t){E.set(t.touches[0].pageX,t.touches[0].pageY),O.subVectors(E,k),z(O.x,O.y),k.copy(E),c.update()}(t);break;default:d=p.NONE}}function Y(t){!1!==c.enabled&&(c.dispatchEvent(h),d=p.NONE)}function B(t){!1!==c.enabled&&t.preventDefault()}c.domElement.addEventListener("contextmenu",B,!1),c.domElement.addEventListener("mousedown",V,!1),c.domElement.addEventListener("wheel",N,!1),c.domElement.addEventListener("touchstart",G,!1),c.domElement.addEventListener("touchend",Y,!1),c.domElement.addEventListener("touchmove",W,!1),window.addEventListener("keydown",Z,!1),this.update()};(o.prototype=Object.create(i.EventDispatcher.prototype)).constructor=o,Object.defineProperties(o.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}}),e.default=o}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(0),o=function(t){i.Loader.call(this,t)};o.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:o,load:function(t,e,n,o){var a=this,r=""===this.path?i.LoaderUtils.extractUrlBase(t):this.path,s=new i.FileLoader(this.manager);s.setPath(this.path),s.load(t,(function(t){e(a.parse(t,r))}),n,o)},setMaterialOptions:function(t){return this.materialOptions=t,this},parse:function(t,e){for(var n=t.split("\n"),i={},a=/\s+/,r={},s=0;s<n.length;s++){var c=n[s];if(0!==(c=c.trim()).length&&"#"!==c.charAt(0)){var u=c.indexOf(" "),l=u>=0?c.substring(0,u):c;l=l.toLowerCase();var h=u>=0?c.substring(u+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},r[h]=i;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var p=h.split(a,3);i[l]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else i[l]=h}}var d=new o.MaterialCreator(this.resourcePath||e,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(r),d}}),(o.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:i.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:i.RepeatWrapping}).prototype={constructor:o.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var i=t[n],o={};for(var a in e[n]=o,i){var r=!0,s=i[a],c=a.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(r=!1)}r&&(o[c]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,n=this.materialsInfo[t],o={name:t,side:this.side};function a(t,n){if(!o[t]){var i,a,r=e.getTextureParams(n,o),s=e.loadTexture((i=e.baseUrl,"string"!=typeof(a=r.url)||""===a?"":/^https?:\/\//i.test(a)?a:i+a));s.repeat.copy(r.scale),s.offset.copy(r.offset),s.wrapS=e.wrap,s.wrapT=e.wrap,o[t]=s}}for(var r in n){var s,c=n[r];if(""!==c)switch(r.toLowerCase()){case"kd":o.color=(new i.Color).fromArray(c);break;case"ks":o.specular=(new i.Color).fromArray(c);break;case"ke":o.emissive=(new i.Color).fromArray(c);break;case"map_kd":a("map",c);break;case"map_ks":a("specularMap",c);break;case"map_ke":a("emissiveMap",c);break;case"norm":a("normalMap",c);break;case"map_bump":case"bump":a("bumpMap",c);break;case"map_d":a("alphaMap",c),o.transparent=!0;break;case"ns":o.shininess=parseFloat(c);break;case"d":(s=parseFloat(c))<1&&(o.opacity=s,o.transparent=!0);break;case"tr":s=parseFloat(c),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(o.opacity=1-s,o.transparent=!0)}}return this.materials[t]=new i.MeshPhongMaterial(o),this.materials[t]},getTextureParams:function(t,e){var n,o={scale:new i.Vector2(1,1),offset:new i.Vector2(0,0)},a=t.split(/\s+/);return(n=a.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(a[n+1]),a.splice(n,2)),(n=a.indexOf("-s"))>=0&&(o.scale.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),(n=a.indexOf("-o"))>=0&&(o.offset.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),o.url=a.join(" ").trim(),o},loadTexture:function(t,e,n,o,a){var r,s=void 0!==this.manager?this.manager:i.DefaultLoadingManager,c=s.getHandler(t);return null===c&&(c=new i.TextureLoader(s)),c.setCrossOrigin&&c.setCrossOrigin(this.crossOrigin),r=c.load(t,n,o,a),void 0!==e&&(r.mapping=e),r}},e.default=o},function(t,e,n){"use strict";n.r(e);var i=n(0),o=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,n=/^usemtl /,o=/^usemap /;function a(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var i=this.vertices,o=this.object.geometry.vertices;o.push(i[t+0],i[t+1],i[t+2]),o.push(i[e+0],i[e+1],i[e+2]),o.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){var i=this.normals,o=this.object.geometry.normals;o.push(i[t+0],i[t+1],i[t+2]),o.push(i[e+0],i[e+1],i[e+2]),o.push(i[n+0],i[n+1],i[n+2])},addColor:function(t,e,n){var i=this.colors,o=this.object.geometry.colors;o.push(i[t+0],i[t+1],i[t+2]),o.push(i[e+0],i[e+1],i[e+2]),o.push(i[n+0],i[n+1],i[n+2])},addUV:function(t,e,n){var i=this.uvs,o=this.object.geometry.uvs;o.push(i[t+0],i[t+1]),o.push(i[e+0],i[e+1]),o.push(i[n+0],i[n+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,i,o,a,r,s,c){var u=this.vertices.length,l=this.parseVertexIndex(t,u),h=this.parseVertexIndex(e,u),p=this.parseVertexIndex(n,u);if(this.addVertex(l,h,p),this.colors.length>0&&this.addColor(l,h,p),void 0!==i&&""!==i){var d=this.uvs.length;l=this.parseUVIndex(i,d),h=this.parseUVIndex(o,d),p=this.parseUVIndex(a,d),this.addUV(l,h,p)}if(void 0!==r&&""!==r){var m=this.normals.length;l=this.parseNormalIndex(r,m),h=r===s?l:this.parseNormalIndex(s,m),p=r===c?l:this.parseNormalIndex(c,m),this.addNormal(l,h,p)}},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,n=0,i=t.length;n<i;n++)this.addVertexPoint(this.parseVertexIndex(t[n],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var n=this.vertices.length,i=this.uvs.length,o=0,a=t.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(t[o],n));var r=0;for(a=e.length;r<a;r++)this.addUVLine(this.parseUVIndex(e[r],i))}};return t.startObject("",!1),t}function r(t){i.Loader.call(this,t),this.materials=null}return r.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:r,load:function(t,e,n,o){var a=this,r=new i.FileLoader(a.manager);r.setPath(this.path),r.load(t,(function(t){e(a.parse(t))}),n,o)},setMaterials:function(t){return this.materials=t,this},parse:function(r){console.time("OBJLoader");var s=new a;-1!==r.indexOf("\r\n")&&(r=r.replace(/\r\n/g,"\n")),-1!==r.indexOf("\\\n")&&(r=r.replace(/\\\n/g,""));for(var c=r.split("\n"),u="",l="",h=[],p="function"==typeof"".trimLeft,d=0,m=c.length;d<m;d++)if(u=c[d],0!==(u=p?u.trimLeft():u.trim()).length&&"#"!==(l=u.charAt(0)))if("v"===l){var f=u.split(/\s+/);switch(f[0]){case"v":s.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7&&s.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]));break;case"vn":s.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":s.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===l){for(var v=u.substr(1).trim().split(/\s+/),y=[],g=0,b=v.length;g<b;g++){var x=v[g];if(x.length>0){var w=x.split("/");y.push(w)}}var M=y[0];for(g=1,b=y.length-1;g<b;g++){var k=y[g],E=y[g+1];s.addFace(M[0],k[0],E[0],M[1],k[1],E[1],M[2],k[2],E[2])}}else if("l"===l){var O=u.substring(1).trim().split(" "),P=[],j=[];if(-1===u.indexOf("/"))P=O;else for(var L=0,C=O.length;L<C;L++){var _=O[L].split("/");""!==_[0]&&P.push(_[0]),""!==_[1]&&j.push(_[1])}s.addLineGeometry(P,j)}else if("p"===l){var S=u.substr(1).trim().split(" ");s.addPointGeometry(S)}else if(null!==(h=t.exec(u))){var T=(" "+h[0].substr(1).trim()).substr(1);s.startObject(T)}else if(n.test(u))s.object.startMaterial(u.substring(7).trim(),s.materialLibraries);else if(e.test(u))s.materialLibraries.push(u.substring(7).trim());else if(o.test(u))console.warn('OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else{if("s"!==l){if("\0"===u)continue;throw new Error('OBJLoader: Unexpected line: "'+u+'"')}if((h=u.split(" ")).length>1){var A=h[1].trim().toLowerCase();s.object.smooth="0"!==A&&"off"!==A}else s.object.smooth=!0;(H=s.object.currentMaterial())&&(H.smooth=s.object.smooth)}s.finalize();var R=new i.Group;R.materialLibraries=[].concat(s.materialLibraries);for(d=0,m=s.objects.length;d<m;d++){var z=s.objects[d],I=z.geometry,D=z.materials,V="Line"===I.type,F="Points"===I.type,U=!1;if(0!==I.vertices.length){var N=new i.BufferGeometry;N.setAttribute("position",new i.Float32BufferAttribute(I.vertices,3)),I.normals.length>0?N.setAttribute("normal",new i.Float32BufferAttribute(I.normals,3)):N.computeVertexNormals(),I.colors.length>0&&(U=!0,N.setAttribute("color",new i.Float32BufferAttribute(I.colors,3))),I.uvs.length>0&&N.setAttribute("uv",new i.Float32BufferAttribute(I.uvs,2));for(var Z,G=[],W=0,Y=D.length;W<Y;W++){var B=D[W],H=void 0;if(null!==this.materials)if(H=this.materials.create(B.name),!V||!H||H instanceof i.LineBasicMaterial){if(F&&H&&!(H instanceof i.PointsMaterial)){var X=new i.PointsMaterial({size:10,sizeAttenuation:!1});i.Material.prototype.copy.call(X,H),X.color.copy(H.color),X.map=H.map,H=X}}else{var q=new i.LineBasicMaterial;i.Material.prototype.copy.call(q,H),q.color.copy(H.color),H=q}H||((H=V?new i.LineBasicMaterial:F?new i.PointsMaterial({size:1,sizeAttenuation:!1}):new i.MeshPhongMaterial).name=B.name),H.flatShading=!B.smooth,H.vertexColors=U?i.VertexColors:i.NoColors,G.push(H)}if(G.length>1){for(W=0,Y=D.length;W<Y;W++){B=D[W];N.addGroup(B.groupStart,B.groupCount,W)}Z=V?new i.LineSegments(N,G):F?new i.Points(N,G):new i.Mesh(N,G)}else Z=V?new i.LineSegments(N,G[0]):F?new i.Points(N,G[0]):new i.Mesh(N,G[0]);Z.name=z.name,R.add(Z)}}return console.timeEnd("OBJLoader"),R}}),r}();e.default=o},function(t,e,n){"use strict";n.r(e),function(t){var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3),c=n.n(s),u=n(4),l=n.n(u),h=n(5),p=n.n(h),d=n(8),m=n(6),f=n(9),v=function(e){function n(e){var i;return o()(this,n),(i=c()(this,l()(n).call(this)))._layerid=0,i.zIndex=1e3,i.status="running",i.type="gps",i.layers=[],i.clock=new t.Clock,i.clock.start(),i.initMap(e),i.initWorld(),i.map.hasGround&&i.addGround(),i.update(),i}return p()(n,e),r()(n,[{key:"initMap",value:function(t){this.map=Object.assign({rotation:0,width:1e3,height:600,pitch:45,zoom:21,center:[0,0]},t)}},{key:"initWorld",value:function(){this.renderer=new t.WebGLRenderer(Object.assign({alpha:!0,antialias:!0},this.map.rendererOptions)),this.renderer.setSize(this.map.width,this.map.height),this.map.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position="relative",this.renderer.domElement.style["pointer-events"]="none",this.renderer.domElement.style["z-index"]=++this.zIndex,this.scene=new t.Scene(Object.assign({},this.map.sceneOptions||{})),this.camera=new t.PerspectiveCamera(45,this.map.width/this.map.height,1e-6,5e9),this.layers=[],this.world=new t.Group,this.scene.add(this.world),this.camera.position.z=10,this.camera.position.x=this.map.center[0],this.camera.position.y=this.map.center[1],this.cameraControl=new d.default(this)}},{key:"moveTo",value:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.preScale;return t.userData.isGeoGroup?n=t:t.parent&&t.parent.userData.isGeoGroup&&(n=t.parent),n.scale.copy(o||1),n.position.copy(this.projectToWorld(e)),t.coordinates=e,t}},{key:"update",value:function(){var t=this,e=this.clock.getDelta();for(var n in this.layers)this.layers[n].update&&this.layers[n].update(e);this.renderer.render(this.scene,this.camera),this.animationframe=requestAnimationFrame((function(n){"stop"!=t.status&&t.update(e,n)}))}},{key:"projectToWorld",value:function(t){return{x:t[0],y:t[1],z:t[2]||0}}},{key:"unprojectFromWorld",value:function(t){return[t.x,t.y,t.z]}},{key:"projectToScreen",value:function(t){var e=Object.assign({},t);e[1]=-e[1];var n=this.projectToWorld(e),i=this.world.getWorldPosition().clone().add(n).project(this.camera),o=this.map.width/2,a=this.map.height/2;return{x:Math.round(i.x*o+o),y:this.map.height-Math.round(i.y*a+a)}}},{key:"unprojectFromScreen",value:function(e){var n=this.map.width/2,i=this.map.height/2,o=-(e.x-n)/n,a=(this.map.height-e.y-i)/i,r=new t.Vector3(o,a,0).unproject(this.camera),s=this.world.getWorldPosition().clone(),c=this.unprojectFromWorld(r.sub(s));return c[1]=-c[1],c}},{key:"add",value:function(e,n,i){var o=new t.Group;return o.userData.isGeoGroup=!0,o.add(e),this.world.add(o),this.moveTo(e,n,i),e}},{key:"addGround",value:function(){var e=new t.PlaneGeometry(f.WORLD_SIZE,f.WORLD_SIZE),n=new t.MeshPhongMaterial({color:this.map.groundColor||6710886,shininess:30}),i=new t.Mesh(e,n);i.position.z=-.01,this.add(i,this.map.center,{scaleToLatitude:!0,preScale:100})}},{key:"remove",value:function(t){this.world.remove(t)}},{key:"setupDefaultLights",value:function(){this.scene.add(new t.AmbientLight(13421772));var e=new t.DirectionalLight(16777215,.5);e.position.set(0,800,1e3),e.matrixWorldNeedsUpdate=!0,this.sunlight=e,this.world.add(e)}}]),n}(m.default);e.default=v}.call(this,n(0))},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"prettyPrintMatrix",(function(){return a})),n.d(e,"makePerspectiveMatrix",(function(){return r})),n.d(e,"radify",(function(){return s})),n.d(e,"degreeify",(function(){return c}));var i=n(7),o=n.n(i);function a(t){for(var e=0;e<4;e++)t[e],t[e+4],t[e+8],t[e+12]}function r(e,n,i,o){var a=new t.Matrix4,r=1/Math.tan(e/2),s=1/(i-o);return a.elements[0]=r/n,a.elements[1]=0,a.elements[2]=0,a.elements[3]=0,a.elements[4]=0,a.elements[5]=r,a.elements[6]=0,a.elements[7]=0,a.elements[8]=0,a.elements[9]=0,a.elements[10]=(o+i)*s,a.elements[11]=-1,a.elements[12]=0,a.elements[13]=0,a.elements[14]=2*o*i*s,a.elements[15]=0,a}function s(t){return"object"===o()(t)?t.map((function(t){return 2*Math.PI*t/360})):2*Math.PI*t/360}function c(t){return 360*t/(2*Math.PI)}}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3),c=n.n(s),u=n(4),l=n.n(u),h=n(5),p=n.n(h),d=function(t){function e(t){var n;for(var i in o()(this,e),(n=c()(this,l()(e).call(this,t))).defaultParams={target:null,viewRotation:0,targetRotation:0,autoUpdate:!1,lockRotation:!0},n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(e,t),r()(e,[{key:"onAdd",value:function(t){this.pigeonMap=t,this.initCamera()}},{key:"initCamera",value:function(){}},{key:"update",value:function(){this.autoUpdate&&this.updateCamera()}},{key:"updateCamera",value:function(t){if(!this.target)return!1;var e=this.target.coordinates;this.lockRotation&&(t||(t=180*this.target.rotation.z/Math.PI+this.targetRotation+this.viewRotation),this.pigeonMap.cameraControl.setRotation(t)),this.pigeonMap.cameraControl.setCenter(e),this.pigeonMap.cameraControl.updateCamera()}}]),e}(n(6).default);e.default=d},function(t,e,n){"use strict";n.r(e);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3),c=n.n(s),u=n(4),l=n.n(u),h=n(5),p=n.n(h),d=function(t){function e(t){var n;for(var i in o()(this,e),(n=c()(this,l()(e).call(this,t))).defaultParams={zoomBase:600,moveSpeed:.84,pitchSpeed:.1,rotateSpeed:.15},n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(e,t),r()(e,[{key:"onAdd",value:function(t){var e=this;this.pigeonMap=t,this.map=this.pigeonMap.map,this.cameraControl=this.pigeonMap.cameraControl,this.initConfig(),this.listenEvents(),this.on("change",(function(){e.pigeonMap.fire("change"),e.cameraControl.update()}))}},{key:"initConfig",value:function(){}},{key:"listenEvents",value:function(){var t=this;this.onDown=function(e){0==e.button?t.mouseStatus="left":2==e.button&&(t.mouseStatus="right"),t.mouseDownPosition={x:e.clientX,y:e.clientY},t.map.container.addEventListener("mousemove",t.onMove)},this.onUp=function(e){t.mouseStatus=!1,t.map.container.removeEventListener("mousemove",t.onMove)},this.onMove=function(e){if(t.mouseStatus){if("left"==t.mouseStatus){var n=e.clientY-t.mouseDownPosition.y,i=e.clientX-t.mouseDownPosition.x,o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));if(o<.1)return!1;var a=(i>0?-1:1)*Math.asin(n/o)+t.map.transform.angle,r=t.moveSpeed*t.map.zoom/1e3;t.map.center[0]+=(i>0?-1:1)*(o*Math.cos(a))*r,t.map.center[1]+=(i>0?-1:1)*(o*Math.sin(a))*r,t.cameraControl.update(),t.fire("move",e),t.fire("change",e)}else"right"==t.mouseStatus&&(t.map.pitch+=t.pitchSpeed*(e.clientY-t.mouseDownPosition.y),t.map.pitch>90?t.map.pitch=90:t.map.pitch<0&&(t.map.pitch=0),t.map.rotation-=t.rotateSpeed*(e.clientX-t.mouseDownPosition.x),t.cameraControl.update(),t.fire("rotate",e),t.fire("change",e));t.mouseDownPosition={x:e.clientX,y:e.clientY}}},this.onWheel=function(e){if(t.map.zoom+=e.deltaY*t.map.zoom/t.zoomBase,t.map.zoom<5)return t.map.zoom=5;t.cameraControl.update(),e.preventDefault(),t.fire("zoom",e),t.fire("change",e)},this.onContextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.map.container.addEventListener("mousedown",this.onDown),this.map.container.addEventListener("mouseup",this.onUp),this.map.container.addEventListener("mousemove",this.onMove),this.map.container.addEventListener("wheel",this.onWheel),this.map.container.addEventListener("contextmenu",this.onContextmenu)}},{key:"removeListenr",value:function(){this.map.container.removeEventListener("mousedown",this.onDown),this.map.container.removeEventListener("mouseup",this.onUp),this.map.container.removeEventListener("mousemove",this.onMove),this.map.container.removeEventListener("wheel",this.onWheel),this.map.container.removeEventListener("contextmenu",this.onContextmenu)}}]),e}(n(6).default);e.default=d},function(t,e,n){"use strict";n.r(e);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3),c=n.n(s),u=n(4),l=n.n(u),h=n(5),p=n.n(h),d=function(t){function e(t){var n;for(var i in o()(this,e),(n=c()(this,l()(e).call(this,t))).defaultParams={fontSize:"14px",color:"#000000",canvasRender:!1},n.texts=[],n.textId=0,n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(e,t),r()(e,[{key:"onAdd",value:function(t){this.pigeonMap=t,this.canvasRender?this.initCanvas():this.initDom();var e=this;function n(){e.updateText()}this.change=n,this.pigeonMap.on("change",n)}},{key:"initDom",value:function(){this.container=this.pigeonMap.map.container;var t=document.createElement("div");t.id="text_layer_"+this.id,t.className="pigeonGL-text-layer",t.setAttribute("width",this.pigeonMap.map.width),t.setAttribute("height",this.pigeonMap.map.height),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.zIndex=++this.pigeonMap.zIndex,this.dom=t,this.container.appendChild(t)}},{key:"initCanvas",value:function(){this.container=this.pigeonMap.map.container;var t=document.createElement("canvas");t.id="text_layer_"+this.id,this.container.appendChild(t),t.setAttribute("width",this.pigeonMap.map.width),t.setAttribute("height",this.pigeonMap.map.height),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.zIndex=++this.pigeonMap.zIndex,this.canvas=t}},{key:"addText",value:function(t){return(t=Object.assign({},t)).id=t.id||"_text_"+this.textId++,this.texts.push(t),t}},{key:"drawText",value:function(){this.canvasRender?this.drawCanvasText():this.drawDomText()}},{key:"drawDomText",value:function(){for(var t in this.dom.innerHTML="",this.texts){var e=this.pigeonMap.projectToScreen(this.texts[t].lnglat),n=document.createElement("span");for(var i in n.id=this.texts[t].id,n.innerHTML=this.texts[t].text,this.dom.appendChild(n),n.style.position="absolute",n.style.top=e.y+"px",n.style.left=e.x+"px",this.texts[t].style)n.style[i]=this.texts[t].style[i]}}},{key:"drawCanvasText",value:function(){var t=this.canvas.getContext("2d");for(var e in t.clearRect(0,0,this.canvas.width,this.canvas.height),this.texts){var n=this.pigeonMap.projectToScreen(this.texts[e].lnglat);t.font=this.texts[e].font||this.font,t.fillStyle=this.texts[e].color||this.color,t.fillText(this.texts[e].text,n.x,n.y)}}},{key:"updateDomText",value:function(){var t=this.dom.querySelectorAll("span");for(var e in this.texts){var n=this.pigeonMap.projectToScreen(this.texts[e].lnglat);t[e].style.top=n.y+"px",t[e].style.left=n.x+"px"}}},{key:"removeText",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return this.texts.splice(e,1),void this.drawText()}},{key:"update",value:function(){}},{key:"updateText",value:function(){this.canvasRender?this.drawCanvasText():this.updateDomText()}},{key:"getText",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return this.text[e]}},{key:"onRemove",value:function(){this.pigeonMap.off("change",this.change),this._listeners=null}},{key:"getTextIndex",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return e}}]),e}(n(6).default);e.default=d},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return d}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3),c=n.n(s),u=n(4),l=n.n(u),h=n(5),p=n.n(h),d=function(t){function e(t){var n;return o()(this,e),(n=c()(this,l()(e).call(this,t))).noVR=!1,n.vrStatus="not suppert VR",n.listenEvents(),n.getVRDisplays(),n}return p()(e,t),r()(e,[{key:"getVRDisplays",value:function(){var t=this;navigator.getVRDisplays&&navigator.getVRDisplays().then((function(e){e.length>0?(t.device=e[0],t.renderer.vr.enabled=!0,t.pigeonMap.renderer.vr.setDevice(t.device),t.frameData=new VRFrameData):(t.vrStatus="noDisplay",console.warn("no vr displays"))})).catch((function(t){console.warn("Unable to get VR Displays")}))}},{key:"listenEvents",value:function(){var t=this;window.addEventListener("vrdisplayconnect",(function(e){t.device=e.display||e.detail.display,t.status,t.renderer.vr.enabled=!0,t.fire("connected",t.device)}),!1),window.addEventListener("vrdisplaydisconnect",(function(e){t.status,t.renderer.vr.enabled=!1,t.fire("disconnet",t.device)}),!1),window.addEventListener("vrdisplaypresentchange",(function(e){t.device=e.display||e.detail.display,t.fire("statuschange",t.device)}),!1)}},{key:"enterVR",value:function(){this.device.requestPresent([{source:this.renderer.domElement}])}},{key:"exitVR",value:function(){this.device.exitPresent()}},{key:"createButton",value:function(t){var e=this;t||((t=document.createElement("button")).style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="transparent",t.style.color="#fff",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="9999",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.textContent="Enter VR",document.body.appendChild(t)),t.addEventListener("click",(function(){e.device&&e.enterVR()}))}},{key:"onAdd",value:function(t){this.pigeonMap=t,this.renderer=t.renderer,this.initVRRenderer()}},{key:"initVRRenderer",value:function(){}}]),e}(n(6).default)},function(t,e,n){"use strict";n.r(e),function(t){var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3),c=n.n(s),u=n(4),l=n.n(u),h=n(5),p=n.n(h),d=function(e){function n(t){var e;return o()(this,n),(e=c()(this,l()(n).call(this,t))).lanePoints=[],e.initPoints(),e}return p()(n,e),r()(n,[{key:"initPoints",value:function(){this.material=new t.PointsMaterial({color:16777215,size:10}),this.pointsGeometry=new t.BufferGeometry,this.points=new t.Points(this.pointsGeometry,this.material)}},{key:"onAdd",value:function(t){this.pigeonMap=t,this.pigeonMap.world.add(this.points)}},{key:"drawPoints",value:function(e){this.baseLngLat=e[0],this.baseXYZ=this.pigeonMap.projectToWorld(this.baseLngLat);var n,i=[],o=[],a=[];for(var r in e)n=this.pigeonMap.projectToWorld(e[r]),i.push(n.x-this.baseXYZ.x,n.y-this.baseXYZ.y,n.z-this.baseXYZ.z),a.push(e[r]),o.push(r);this.points.geometry.addAttribute("position",new t.Float32BufferAttribute(i,3)),this.points.geometry.computeBoundingSphere(),this.points.position.x=this.baseXYZ.x,this.points.position.y=this.baseXYZ.y,this.points.position.z=this.baseXYZ.z}}]),n}(n(6).default);e.default=d}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return v}));var i=n(10),o=n.n(i),a=n(1),r=n.n(a),s=n(2),c=n.n(s),u=n(3),l=n.n(u),h=n(4),p=n.n(h),d=n(5),m=n.n(d),f=n(0),v=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgba(255, 255, 255, 1)";return r()(this,e),(t=l()(this,p()(e).call(this,new f.SpriteMaterial({map:new f.Texture}))))._text=n,t._textHeight=i,t._color=o,t._fontFace="Arial",t._fontSize=90,t._fontWeight="normal",t._canvas=document.createElement("canvas"),t._texture=t.material.map,t._texture.minFilter=f.LinearFilter,t._genCanvas(),t}return m()(e,t),c()(e,[{key:"_genCanvas",value:function(){var t=this,e=this._canvas,n=e.getContext("2d"),i=this._text.split("\n");e.width=Math.max.apply(Math,o()(i.map((function(t){return n.measureText(t).width})))),e.height=this.fontSize*i.length,n.font="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace),n.fillStyle=this.color,n.textBaseline="bottom",i.forEach((function(i,o){return n.fillText(i,(e.width-n.measureText(i).width)/2,(o+1)*t.fontSize)})),this._texture.image=e,this._texture.needsUpdate=!0;var a=this.textHeight*i.length;this.scale.set(a*e.width/e.height,a)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(t){return f.Sprite.prototype.copy.call(this,t),this.color=t.color,this.fontFace=t.fontFace,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(t){this._textHeight=t,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(t){this._fontFace=t,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._genCanvas()}}]),e}(f.Sprite)},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}}]).default}));