{"code":"!function(t){var e={};function i(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(a,r,function(e){return t[e]}.bind(null,r));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=14)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}t.exports=function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}},function(t,e,i){var a=i(7),r=i(15);t.exports=function(t,e){return!e||\"object\"!==a(e)&&\"function\"!=typeof e?r(t):e}},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i},function(t,e,i){var a=i(16);t.exports=function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=function(){function t(e){a()(this,t);for(var i in this._userConfig=e,e)this[i]=e[i]}return n()(t,[{key:\"on\",value:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}},{key:\"fire\",value:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i)for(var a=i.slice(0),r=0,n=a.length;r<n;r++)a[r].call(this,e)}}},{key:\"off\",value:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i)if(e){var a=i.indexOf(e);-1!==a&&i.splice(a,1)}else this._listeners[t]=[]}}},{key:\"initConfig\",value:function(t){}},{key:\"onAdd\",value:function(t){this.pigeonMap=t}},{key:\"update\",value:function(){}},{key:\"onRemove\",value:function(){this._listeners&&(this._listeners=[])}}]),t}();t.exports=o}.call(this,i(6)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,\"loaded\",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,\"id\",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,\"exports\",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e){function i(t){return(i=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function a(e){return\"function\"==typeof Symbol&&\"symbol\"===i(Symbol.iterator)?t.exports=a=function(t){return i(t)}:t.exports=a=function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":i(t)},a(e)}t.exports=a},function(t,e){var i=512*Math.pow(2,0);t.exports={WORLD_SIZE_RATIO:0,WORLD_SIZE:i,PROJECTION_WORLD_SIZE:i/(6378137*Math.PI)/2,MERCATOR_A:6378137,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_CIRCUMFERENCE:40075e3,DISTANCE:200}},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(7),a=i.n(e);t.exports.prettyPrintMatrix=function(t){for(var e=0;e<4;e++)t[e],t[e+4],t[e+8],t[e+12]},t.exports.makePerspectiveMatrix=function(t,e,i,a){var r=new THREE.Matrix4,n=1/Math.tan(t/2),o=1/(i-a);return r.elements[0]=n/e,r.elements[1]=0,r.elements[2]=0,r.elements[3]=0,r.elements[4]=0,r.elements[5]=n,r.elements[6]=0,r.elements[7]=0,r.elements[8]=0,r.elements[9]=0,r.elements[10]=(a+i)*o,r.elements[11]=-1,r.elements[12]=0,r.elements[13]=0,r.elements[14]=2*a*i*o,r.elements[15]=0,r},t.exports.radify=function(t){return\"object\"===a()(t)?t.map((function(t){return 2*Math.PI*t/360})):2*Math.PI*t/360},t.exports.degreeify=function(t){return 360*t/(2*Math.PI)}}.call(this,i(6)(t))},function(t,e){var i=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager};i.prototype={constructor:i,load:function(t,e,i,a){var r=this,n=new THREE.FileLoader(this.manager);n.setPath(this.path),n.load(t,(function(t){e(r.parse(t))}),i,a)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn(\"THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.\"),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split(\"\\n\"),a={},r=/\\s+/,n={},o=0;o<e.length;o++){var s=e[o];if(0!==(s=s.trim()).length&&\"#\"!==s.charAt(0)){var h=s.indexOf(\" \"),l=h>=0?s.substring(0,h):s;l=l.toLowerCase();var p=h>=0?s.substring(h+1):\"\";if(p=p.trim(),\"newmtl\"===l)a={name:p},n[p]=a;else if(a)if(\"ka\"===l||\"kd\"===l||\"ks\"===l){var c=p.split(r,3);a[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else a[l]=p}}var u=new i.MaterialCreator(this.texturePath||this.path,this.materialOptions);return u.setCrossOrigin(this.crossOrigin),u.setManager(this.manager),u.setMaterials(n),u}},(i.MaterialCreator=function(t,e){this.baseUrl=t||\"\",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping}).prototype={constructor:i.MaterialCreator,setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var i in t){var a=t[i],r={};for(var n in e[i]=r,a){var o=!0,s=a[n],h=n.toLowerCase();switch(h){case\"kd\":case\"ka\":case\"ks\":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(r[h]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,i=this.materialsInfo[t],a={name:t,side:this.side};function r(t,i){if(!a[t]){var r,n,o=e.getTextureParams(i,a),s=e.loadTexture((r=e.baseUrl,\"string\"!=typeof(n=o.url)||\"\"===n?\"\":/^https?:\\/\\//i.test(n)?n:r+n));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=e.wrap,s.wrapT=e.wrap,a[t]=s}}for(var n in i){var o=i[n];if(\"\"!==o)switch(n.toLowerCase()){case\"kd\":a.color=(new THREE.Color).fromArray(o);break;case\"ks\":a.specular=(new THREE.Color).fromArray(o);break;case\"map_kd\":r(\"map\",o);break;case\"map_ks\":r(\"specularMap\",o);break;case\"map_bump\":case\"bump\":r(\"bumpMap\",o);break;case\"ns\":a.shininess=parseFloat(o);break;case\"d\":o<1&&(a.opacity=o,a.transparent=!0);break;case\"Tr\":o>0&&(a.opacity=1-o,a.transparent=!0)}}return this.materials[t]=new THREE.MeshPhongMaterial(a),this.materials[t]},getTextureParams:function(t,e){var i,a={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},r=t.split(/\\s+/);return(i=r.indexOf(\"-bm\"))>=0&&(e.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),(i=r.indexOf(\"-s\"))>=0&&(a.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),(i=r.indexOf(\"-o\"))>=0&&(a.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),a.url=r.join(\" \").trim(),a},loadTexture:function(t,e,i,a,r){var n,o=THREE.Loader.Handlers.get(t),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),n=o.load(t,i,a,r),void 0!==e&&(n.mapping=e),n}},t.exports=i},function(t,e){var i=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,normal_pattern:/^vn\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,uv_pattern:/^vt\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,face_vertex:/^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,face_vertex_uv:/^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,face_vertex_uv_normal:/^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,face_vertex_normal:/^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,object_pattern:/^[og]\\s*(.+)?/,smoothing_pattern:/^s\\s+(\\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};i.prototype={constructor:i,load:function(t,e,i,a){var r=this,n=new THREE.FileLoader(r.manager);n.setPath(this.path),n.load(t,(function(t){e(r.parse(t))}),i,a)},setPath:function(t){this.path=t},setMaterials:function(t){this.materials=t},_createParserState:function(){var t={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var i=this.object&&\"function\"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&\"function\"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||\"\",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var a={index:this.materials.length,name:t||\"\",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:\"\",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:\"number\"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return t&&0===this.materials.length&&this.materials.push({name:\"\",smooth:this.smooth}),e}},i&&i.name&&\"function\"==typeof i.clone){var a=i.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&\"function\"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseNormalIndex:function(t,e){var i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseUVIndex:function(t,e){var i=parseInt(t,10);return 2*(i>=0?i-1:i+e/2)},addVertex:function(t,e,i){var a=this.vertices,r=this.object.geometry.vertices;r.push(a[t+0]),r.push(a[t+1]),r.push(a[t+2]),r.push(a[e+0]),r.push(a[e+1]),r.push(a[e+2]),r.push(a[i+0]),r.push(a[i+1]),r.push(a[i+2])},addVertexLine:function(t){var e=this.vertices,i=this.object.geometry.vertices;i.push(e[t+0]),i.push(e[t+1]),i.push(e[t+2])},addNormal:function(t,e,i){var a=this.normals,r=this.object.geometry.normals;r.push(a[t+0]),r.push(a[t+1]),r.push(a[t+2]),r.push(a[e+0]),r.push(a[e+1]),r.push(a[e+2]),r.push(a[i+0]),r.push(a[i+1]),r.push(a[i+2])},addUV:function(t,e,i){var a=this.uvs,r=this.object.geometry.uvs;r.push(a[t+0]),r.push(a[t+1]),r.push(a[e+0]),r.push(a[e+1]),r.push(a[i+0]),r.push(a[i+1])},addUVLine:function(t){var e=this.uvs,i=this.object.geometry.uvs;i.push(e[t+0]),i.push(e[t+1])},addFace:function(t,e,i,a,r,n,o,s,h,l,p,c){var u,m=this.vertices.length,d=this.parseVertexIndex(t,m),f=this.parseVertexIndex(e,m),v=this.parseVertexIndex(i,m);if(void 0===a?this.addVertex(d,f,v):(u=this.parseVertexIndex(a,m),this.addVertex(d,f,u),this.addVertex(f,v,u)),void 0!==r){var y=this.uvs.length;d=this.parseUVIndex(r,y),f=this.parseUVIndex(n,y),v=this.parseUVIndex(o,y),void 0===a?this.addUV(d,f,v):(u=this.parseUVIndex(s,y),this.addUV(d,f,u),this.addUV(f,v,u))}if(void 0!==h){var g=this.normals.length;d=this.parseNormalIndex(h,g),f=h===l?d:this.parseNormalIndex(l,g),v=h===p?d:this.parseNormalIndex(p,g),void 0===a?this.addNormal(d,f,v):(u=this.parseNormalIndex(c,g),this.addNormal(d,f,u),this.addNormal(f,v,u))}},addLineGeometry:function(t,e){this.object.geometry.type=\"Line\";for(var i=this.vertices.length,a=this.uvs.length,r=0,n=t.length;r<n;r++)this.addVertexLine(this.parseVertexIndex(t[r],i));var o=0;for(n=e.length;o<n;o++)this.addUVLine(this.parseUVIndex(e[o],a))}};return t.startObject(\"\",!1),t},parse:function(t){var e=this._createParserState();-1!==t.indexOf(\"\\r\\n\")&&(t=t.replace(/\\r\\n/g,\"\\n\")),-1!==t.indexOf(\"\\\\\\n\")&&(t=t.replace(/\\\\\\n/g,\"\"));for(var i=t.split(\"\\n\"),a=\"\",r=\"\",n=\"\",o=[],s=\"function\"==typeof\"\".trimLeft,h=0,l=i.length;h<l;h++)if(a=i[h],0!==(a=s?a.trimLeft():a.trim()).length&&\"#\"!==(r=a.charAt(0)))if(\"v\"===r)if(\" \"===(n=a.charAt(1))&&null!==(o=this.regexp.vertex_pattern.exec(a)))e.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(\"n\"===n&&null!==(o=this.regexp.normal_pattern.exec(a)))e.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else{if(\"t\"!==n||null===(o=this.regexp.uv_pattern.exec(a)))throw new Error(\"Unexpected vertex/normal/uv line: '\"+a+\"'\");e.uvs.push(parseFloat(o[1]),parseFloat(o[2]))}else if(\"f\"===r)if(null!==(o=this.regexp.face_vertex_uv_normal.exec(a)))e.addFace(o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12]);else if(null!==(o=this.regexp.face_vertex_uv.exec(a)))e.addFace(o[1],o[3],o[5],o[7],o[2],o[4],o[6],o[8]);else if(null!==(o=this.regexp.face_vertex_normal.exec(a)))e.addFace(o[1],o[3],o[5],o[7],void 0,void 0,void 0,void 0,o[2],o[4],o[6],o[8]);else{if(null===(o=this.regexp.face_vertex.exec(a)))throw new Error(\"Unexpected face line: '\"+a+\"'\");e.addFace(o[1],o[2],o[3],o[4])}else if(\"l\"===r){var p=a.substring(1).trim().split(\" \"),c=[],u=[];if(-1===a.indexOf(\"/\"))c=p;else for(var m=0,d=p.length;m<d;m++){var f=p[m].split(\"/\");\"\"!==f[0]&&c.push(f[0]),\"\"!==f[1]&&u.push(f[1])}e.addLineGeometry(c,u)}else if(null!==(o=this.regexp.object_pattern.exec(a))){var v=(\" \"+o[0].substr(1).trim()).substr(1);e.startObject(v)}else if(this.regexp.material_use_pattern.test(a))e.object.startMaterial(a.substring(7).trim(),e.materialLibraries);else if(this.regexp.material_library_pattern.test(a))e.materialLibraries.push(a.substring(7).trim());else{if(null===(o=this.regexp.smoothing_pattern.exec(a))){if(\"\\0\"===a)continue;throw new Error(\"Unexpected line: '\"+a+\"'\")}var y=o[1].trim().toLowerCase();e.object.smooth=\"1\"===y||\"on\"===y,(k=e.object.currentMaterial())&&(k.smooth=e.object.smooth)}e.finalize();var g=new THREE.Group;g.materialLibraries=[].concat(e.materialLibraries);for(h=0,l=e.objects.length;h<l;h++){var E=e.objects[h],x=E.geometry,M=E.materials,w=\"Line\"===x.type;if(0!==x.vertices.length){var b=new THREE.BufferGeometry;b.addAttribute(\"position\",new THREE.BufferAttribute(new Float32Array(x.vertices),3)),x.normals.length>0?b.addAttribute(\"normal\",new THREE.BufferAttribute(new Float32Array(x.normals),3)):b.computeVertexNormals(),x.uvs.length>0&&b.addAttribute(\"uv\",new THREE.BufferAttribute(new Float32Array(x.uvs),2));for(var T,R=[],P=0,_=M.length;P<_;P++){var S=M[P],k=void 0;if(null!==this.materials&&(k=this.materials.create(S.name),w&&k&&!(k instanceof THREE.LineBasicMaterial))){var j=new THREE.LineBasicMaterial;j.copy(k),j.lights=!1,k=j}k||((k=w?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=S.name),k.flatShading=S.smooth?THREE.SmoothShading:THREE.FlatShading,R.push(k)}if(R.length>1){for(P=0,_=M.length;P<_;P++){S=M[P];b.addGroup(S.groupStart,S.groupCount,P)}var L=new THREE.MultiMaterial(R);T=w?new THREE.LineSegments(b,L):new THREE.Mesh(b,L)}else T=w?new THREE.LineSegments(b,R[0]):new THREE.Mesh(b,R[0]);T.name=E.name,g.add(T)}}return g}},t.exports=i},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=i(8),m=i(13),d=(i(9),function(t){function e(t){var i;return a()(this,e),(i=s()(this,l()(e).call(this)))._layerid=0,i.zIndex=1e3,i.status=\"running\",i.type=\"gps\",i.clock=new THREE.Clock,i.clock.start(),i.initMap(t),i.initWorld(),i.map.hasGround&&i.addGround(),i.update(),i}return c()(e,t),n()(e,[{key:\"initWorld\",value:function(){this.renderer=new THREE.WebGLRenderer(Object.assign({alpha:!0,antialias:!0},this.map.rendererOptions)),this.renderer.setSize(this.map.width,this.map.height),this.map.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position=\"relative\",this.renderer.domElement.style[\"pointer-events\"]=\"none\",this.renderer.domElement.style[\"z-index\"]=++this.zIndex;this.scene=new THREE.Scene(Object.assign({},this.map.sceneOptions||{})),this.camera=new THREE.PerspectiveCamera(28,this.map.width/this.map.height,1e-6,5e9),this.layers=[],this.world=new THREE.Group,this.scene.add(this.world),this.cameraControl=new m(this)}},{key:\"initMap\",value:function(t){t.transform?(this.map=t,this.map.MAP_TYPE=\"mapbox\",this.map.width=this.map.transform.width,this.map.height=this.map.transform.height,this.map.container=this.map._container,this.map.on(\"resize\",(function(){_this.renderer.setSize(_this.map.width,_this.map.height)}))):t.poiOnAMAP?(this.map=t,this.map.MAP_TYPE=\"amap\",this.map.container=this.map.getContainer(),this.map.width=this.map.container.clientWidth,this.map.height=this.map.container.clientHeight,this.map.on(\"resize\",(function(){_this.renderer.setSize(_this.map.width,_this.map.height)}))):(this.map=Object.assign({rotation:0,width:1e3,height:600,pitch:45,zoom:21,center:[0,0]},t),this.map.MAP_TYPE=\"none\")}},{key:\"update\",value:function(t){t=this.clock.getDelta();for(var e in this.layers)this.layers[e].update&&this.layers[e].update(t);this.renderer.render(this.scene,this.camera);var i,a=this;(i=this.renderer.vr.getDevice())?i.requestAnimationFrame((function(e){\"stop\"!=a.status&&a.update(t)})):requestAnimationFrame((function(e){\"stop\"!=a.status&&a.update(t)}))}},{key:\"addLayer\",value:function(t){t.id=++this._layerid,this.layers.push(t),t.onAdd(this)}},{key:\"removeLayer\",value:function(t){for(var e in this.layers)if(this.layers[e].id==t.id)return this.layers[e].onRemove(),void this.layers.splice(e,1)}},{key:\"setProjectType\",value:function(t){this.type=t,this.cameraControl.type=t}},{key:\"projectToWorld\",value:function(t){if(\"utm\"==this.type)return this.projectUTMToWorld(t);var e=[-u.MERCATOR_A*t[0]*u.DEG2RAD*u.PROJECTION_WORLD_SIZE,-u.MERCATOR_A*Math.log(Math.tan(.25*Math.PI+.5*t[1]*u.DEG2RAD))*u.PROJECTION_WORLD_SIZE],i=this.projectedUnitsPerMeter(t[1]),a=t[2]||0;return e.push(a*i),new THREE.Vector3(e[0],e[1],e[2])}},{key:\"projectUTMToWorld\",value:function(t){return t}},{key:\"projectedUnitsPerMeter\",value:function(t){return Math.abs(u.WORLD_SIZE*(1/Math.cos(t*Math.PI/180))/u.EARTH_CIRCUMFERENCE)}},{key:\"_scaleVerticesToMeters\",value:function(t,e){for(var i=this.projectedUnitsPerMeter(t[1]),a=(this.projectToWorld(t),0);a<e.length;a++)e[a].multiplyScalar(i);return e}},{key:\"projectToScreen\",value:function(t){var e=Object.assign({},t);e[1]=-e[1];var i=this.projectToWorld(e),a=this.world.getWorldPosition().clone().add(i).project(this.camera),r=(this.map.transform.scale,this.map.width/2),n=this.map.height/2;return{x:Math.round(a.x*r+r),y:this.map.height-Math.round(a.y*n+n)}}},{key:\"unprojectFromScreen\",value:function(t){var e=this.map.width/2,i=this.map.height/2,a=-(t.x-e)/e,r=(this.map.height-t.y-i)/i,n=(this.map.transform.scale,new THREE.Vector3(a,r,0).unproject(this.camera)),o=this.world.getWorldPosition().clone(),s=this.unprojectFromWorld(n.sub(o));return s[1]=-s[1],s}},{key:\"unprojectFromWorld\",value:function(t){var e=[-t.x/(u.MERCATOR_A*u.DEG2RAD*u.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(t.y/(u.PROJECTION_WORLD_SIZE*-u.MERCATOR_A)))-Math.PI/4)/u.DEG2RAD],i=this.projectedUnitsPerMeter(e[1]),a=t.z||0;return e.push(a/i),e}},{key:\"_flipMaterialSides\",value:function(t){}},{key:\"addAtCoordinate\",value:function(t,e,i){var a=new THREE.Group;return a.userData.isGeoGroup=!0,a.add(t),this._flipMaterialSides(t),this.world.add(a),this.moveToCoordinate(t,e,i),t}},{key:\"moveToCoordinate\",value:function(t,e,i){void 0===i&&(i={}),void 0===i.preScale&&(i.preScale=1),(void 0===i.scaleToLatitude||t.userData.scaleToLatitude)&&(i.scaleToLatitude=!0),t.userData.scaleToLatitude=i.scaleToLatitude,\"number\"==typeof i.preScale?i.preScale=new THREE.Vector3(i.preScale,i.preScale,i.preScale):i.preScale.constructor===Array&&3===i.preScale.length?i.preScale=new THREE.Vector3(i.preScale[0],i.preScale[1],i.preScale[2]):i.preScale.constructor!==THREE.Vector3&&(console.warn(\"Invalid preScale value: number, Array with length 3, or THREE.Vector3 expected. Defaulting to [1,1,1]\"),i.preScale=new THREE.Vector3(1,1,1));var a,r=i.preScale;if(t.userData.isGeoGroup)a=t;else{if(!t.parent||!t.parent.userData.isGeoGroup)return console.error(\"Cannot set geographic coordinates of object that does not have an associated GeoGroup. Object must be added to scene with 'addAtCoordinate()'.\");a=t.parent}if(i.scaleToLatitude){var n=this.projectedUnitsPerMeter(e[1]);r.multiplyScalar(n)}return a.scale.copy(r),a.position.copy(this.projectToWorld(e)),t.coordinates=e,t}},{key:\"addGeoreferencedMesh\",value:function(t,e){}},{key:\"addGround\",value:function(){var t=new THREE.PlaneGeometry(u.WORLD_SIZE,u.WORLD_SIZE),e=new THREE.MeshPhongMaterial({color:this.map.groundColor||6710886,shininess:30}),i=new THREE.Mesh(t,e);i.position.z=-.01,this.addAtCoordinate(i,this.map.center,{scaleToLatitude:!0,preScale:100})}},{key:\"getDataLayer\",value:function(t){for(var e=0;e<this.layers.length;e++)if(this.layer.id===t)return layer}},{key:\"remove\",value:function(t){this.world.remove(t)}},{key:\"setupDefaultLights\",value:function(){this.scene.add(new THREE.AmbientLight(13421772));var t=new THREE.DirectionalLight(16777215,.5);t.position.set(0,800,1e3),t.matrixWorldNeedsUpdate=!0,this.world.add(t)}}]),e}(i(5)));t.exports=exports=d}.call(this,i(6)(t))},function(t,e,i){var a=i(9),r=i(8);function n(t){this.scope=t,this.map=t.map,this.camera=t.camera,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=t.world||new THREE.Group,this.world.position.x=this.world.position.y=r.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1;this.listenMapChange()}n.prototype={updateMap:function(t){this.map=Object.assign(this.map,t);\"mapbox\"==this.map.MAP_TYPE?this.updateCamera():\"amap\"==this.map.MAP_TYPE?(this.syncAmap(),this.updateAmapCamera()):\"none\"==this.map.MAP_TYPE&&(this.initMapTransform(),this.updateCamera())},listenMapChange:function(){var t=this;if(this.updateMap(this.map),\"mapbox\"==this.map.MAP_TYPE)this.map.on(\"move\",(function(){t.updateCamera()}));else if(\"amap\"==this.map.MAP_TYPE){this.map.getContainer().addEventListener(\"mousemove\",(function(){t.updateMap()}))}else this.map.MAP_TYPE},syncAmap:function(){var t={},e=(this.map,this.map.getContainer()),i=this.map.getCenter(),a=this.map.getZoom(),r=this.map.getPitch(),n=this.map.getRotation();t.width=e.clientWidth,t.height=e.clientHeight,t.x=this.lngX(i.L,a),t.y=this.latY(i.N,a),t.scale=this.getScale(a),t._pitch=r*Math.PI/180||0,t.angle=n*Math.PI/180||0,this.map.transform=t,this.map.fov=Math.PI/20},initMapTransform:function(){var t={};this.map;t.width=this.map.width,t.height=this.map.height,t.x=this.lngX(this.map.center[0],this.map.zoom),t.y=this.latY(this.map.center[1],this.map.zoom),t.scale=this.getScale(this.map.zoom),t._pitch=this.map.pitch*Math.PI/180||0,t.angle=this.map.rotation*Math.PI/180||0,this.map.transform=t},lngX:function(t,e){return(180+t)*this.getWorldSize(e)/360},latY:function(t,e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.getWorldSize(e)/360},getWorldSize:function(t){return r.WORLD_SIZE*this.getScale(t)},getScale:function(t){return Math.pow(2,t-r.WORLD_SIZE_RATIO||1)},setCenter:function(t){\"mapbox\"==this.map.MAP_TYPE?this.map.setCenter(t):\"amap\"==this.map.MAP_TYPE?this.map.setCenter(t):\"none\"==this.map.MAP_TYPE&&(this.map.center=t,this.initMapTransform())},setRotation:function(t){this.map.rotation=t,\"mapbox\"==this.map.MAP_TYPE?this.map.setRotation(center):\"amap\"==this.map.MAP_TYPE?this.map.setRotation(center):\"none\"==this.map.MAP_TYPE&&(this.map.transform.angle=this.map.rotation*Math.PI/180)},setPitch:function(t){this.map.pitch=t,this.map.rotation=t,\"mapbox\"==this.map.MAP_TYPE?this.map.setPitch(t):\"amap\"==this.map.MAP_TYPE?this.map.setPitch(t):\"none\"==this.map.MAP_TYPE&&(this.map.transform._pitch=this.map.pitch*Math.PI/180)},updateCamera:function(t){if(this.camera){var e=this.map.fov||.6435011087932844,i=.5/Math.tan(e/2)*this.map.transform.height,n=e/2,o=Math.PI/2+this.map.transform._pitch,s=Math.sin(n)*i/Math.sin(Math.PI-o-n),h=1.01*(Math.cos(Math.PI/2-this.map.transform._pitch)*s+i);this.camera.far=h,this.camera.fov=e,this.camera.position.z=i,this.camera.rotation.z=this.map.transform.angle,this.camera.rotation.x=this.map.transform._pitch,this.camera.projectionMatrix=a.makePerspectiveMatrix(e,this.map.transform.width/this.map.transform.height,1,h);var l=new THREE.Matrix4,p=(new THREE.Matrix4).makeTranslation(0,0,i),c=(new THREE.Matrix4).makeRotationX(this.map.transform._pitch),u=(new THREE.Matrix4).makeRotationZ(this.map.transform.angle);l.premultiply(p).premultiply(c).premultiply(u),this.camera.matrixWorld.copy(l);var m=this.map.transform.scale,d=new THREE.Matrix4,f=new THREE.Matrix4,v=new THREE.Matrix4,y=new THREE.Matrix4;d.makeScale(m,m,m),f.makeTranslation(r.WORLD_SIZE/2,-r.WORLD_SIZE/2,0),v.makeTranslation(-this.map.transform.x,this.map.transform.y,0),y.makeRotationZ(Math.PI),this.world.matrix=new THREE.Matrix4;(new THREE.Matrix4).makeTranslation(0,0,-i);this.world.matrix.premultiply(y).premultiply(f).premultiply(d).premultiply(v),a.prettyPrintMatrix(this.camera.projectionMatrix.elements)}else console.log(\"nocamera\")},updateAmapCamera:function(t){var e=this.map.fov||.6435011087932844,i=.5/Math.tan(e/2)*this.map.transform.height,n=e/2,o=Math.PI/2+this.map.transform._pitch,s=Math.sin(n)*i/Math.sin(Math.PI-o-n),h=1.01*(Math.cos(Math.PI/2-this.map.transform._pitch)*s+i);this.camera.projectionMatrix=a.makePerspectiveMatrix(e,this.map.transform.width/this.map.transform.height,1,h);var l=new THREE.Matrix4,p=(new THREE.Matrix4).makeTranslation(0,0,i),c=(new THREE.Matrix4).makeRotationX(this.map.transform._pitch),u=(new THREE.Matrix4).makeRotationZ(this.map.transform.angle);this.camera.position.z=p,l.premultiply(p).premultiply(c).premultiply(u),this.camera.matrixWorld.copy(l);var m=this.map.transform.scale,d=new THREE.Matrix4,f=new THREE.Matrix4,v=new THREE.Matrix4,y=new THREE.Matrix4;d.makeScale(m,m,m),f.makeTranslation(r.WORLD_SIZE/2,-r.WORLD_SIZE/2,0),v.makeTranslation(-this.map.transform.x,this.map.transform.y,0),y.makeRotationZ(Math.PI),this.world.matrix=new THREE.Matrix4,this.world.matrix.premultiply(y).premultiply(f).premultiply(d).premultiply(v)}},t.exports=n},function(t,e,i){var a={MTLLoader:i(10),OBJLoader:i(11),Map:i(12),UTMMap:i(17),Layer:i(5),CameraControl:i(13),SymbolLayer3D:i(19),ThirdPersonView:i(21),MapControl:i(22),TextLayer:i(23),VRLayer:i(24),CloudPoints:i(25)};window.PigeonGL=a},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}},function(t,e){function i(e,a){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(e,a)}t.exports=i},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=i(12),m=i(18),d=function(t){function e(){var t,i;a()(this,e);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(i=s()(this,(t=l()(e)).call.apply(t,[this].concat(n)))).isUTM=!0,i}return c()(e,t),n()(e,[{key:\"initWorld\",value:function(){this.renderer=new THREE.WebGLRenderer(Object.assign({alpha:!0,antialias:!0},this.map.rendererOptions)),this.renderer.setSize(this.map.width,this.map.height),this.map.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position=\"relative\",this.renderer.domElement.style[\"pointer-events\"]=\"none\",this.renderer.domElement.style[\"z-index\"]=++this.zIndex;this.scene=new THREE.Scene(Object.assign({},this.map.sceneOptions||{})),this.camera=new THREE.PerspectiveCamera(45,this.map.width/this.map.height,1e-6,5e9),this.layers=[],this.world=new THREE.Group,this.scene.add(this.world),this.camera.position.z=10,this.camera.position.x=this.map.center[0],this.camera.position.y=this.map.center[1],this.cameraControl=new m(this)}},{key:\"updateMap\",value:function(){}},{key:\"moveToCoordinate\",value:function(t,e,i){void 0===i&&(i={}),void 0===i.preScale&&(i.preScale=1),(void 0===i.scaleToLatitude||t.userData.scaleToLatitude)&&(i.scaleToLatitude=!0),t.userData.scaleToLatitude=i.scaleToLatitude,\"number\"==typeof i.preScale?i.preScale=new THREE.Vector3(i.preScale,i.preScale,i.preScale):i.preScale.constructor===Array&&3===i.preScale.length?i.preScale=new THREE.Vector3(i.preScale[0],i.preScale[1],i.preScale[2]):i.preScale.constructor!==THREE.Vector3&&(console.warn(\"Invalid preScale value: number, Array with length 3, or THREE.Vector3 expected. Defaulting to [1,1,1]\"),i.preScale=new THREE.Vector3(1,1,1));var a,r=i.preScale;if(t.userData.isGeoGroup)a=t;else{if(!t.parent||!t.parent.userData.isGeoGroup)return console.error(\"Cannot set geographic coordinates of object that does not have an associated GeoGroup. Object must be added to scene with 'addAtCoordinate()'.\");a=t.parent}return a.scale.copy(r),a.position.copy(this.projectToWorld(e)),t.coordinates=e,t}},{key:\"update\",value:function(){var t=this.clock.getDelta();for(var e in this.layers)this.layers[e].update&&this.layers[e].update(t);this.renderer.render(this.scene,this.camera);var i,a=this;(i=this.renderer.vr.getDevice())?this.animationframe=i.requestAnimationFrame((function(e){\"stop\"!=a.status&&a.update(t)})):this.animationframe=requestAnimationFrame((function(e){\"stop\"!=a.status&&a.update(t)}))}},{key:\"projectToWorld\",value:function(t){return{x:t[0],y:t[1],z:t[2]||0}}},{key:\"unprojectFromWorld\",value:function(t){return[t.x,t.y,t.z]}},{key:\"projectedUnitsPerMeter\",value:function(){return 1}}]),e}(u);t.exports=d}.call(this,i(6)(t))},function(t,e,i){var a=i(8),r=i(9);function n(t){this.scope=t,this.map=t.map,this.camera=t.camera,this.active=!0,this.world=t.world||new THREE.Group,this.world.position.x=this.world.position.y=0,this.camera.matrixAutoUpdate=!1;this.listenMapChange()}n.prototype={updateMap:function(t){this.map=Object.assign(this.map,t);this.initMapTransform(),this.updateCamera()},listenMapChange:function(){this.updateMap(this.map)},initMapTransform:function(){var t={};this.map;t.width=this.map.width,t.height=this.map.height,t.zHeight=this.map.zHeight||0,t.x=this.map.center[0],t.y=this.map.center[1],t.scale=this.getScale(this.map.zoom),t.z=this.map.center[2]||this.getZ(t.scale),t._pitch=this.map.pitch*Math.PI/180||0,t.angle=this.map.rotation*Math.PI/180||0,this.map.transform=t},getZ:function(t){return a.MERCATOR_A/t},getScale:function(t){return Math.pow(2,t-a.WORLD_SIZE_RATIO||1)},setCenter:function(t){this.map.center=t,this.initMapTransform()},setRotation:function(t){this.map.rotation=t,this.map.transform.angle=this.map.rotation*Math.PI/180},setPitch:function(t){this.map.pitch=t,this.map.transform._pitch=this.map.pitch*Math.PI/180},updateCamera:function(t){var e=Math.abs(this.map.transform.z)+this.map.transform.zHeight,i=this.map.fov||.6435011087932844,a=e,n=i/2,o=Math.PI/2+this.map.transform._pitch,s=Math.sin(n)*a/Math.sin(Math.PI-o-n),h=1.01*(Math.cos(Math.PI/2-this.map.transform._pitch)*s+a);this.camera.projectionMatrix=r.makePerspectiveMatrix(i,this.map.transform.width/this.map.transform.height,1,h);var l=new THREE.Matrix4,p=(new THREE.Matrix4).makeTranslation(0,0,e),c=(new THREE.Matrix4).makeRotationX(this.map.transform._pitch),u=(new THREE.Matrix4).makeRotationZ(this.map.transform.angle);l.premultiply(p).premultiply(c).premultiply(u),this.camera.matrixWorld.copy(l),this.world.position.x=-this.map.transform.x,this.world.position.y=-this.map.transform.y}},t.exports=n},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(7),a=i.n(e),r=(i(8),i(9),i(20)),n=i(11),o=i(10);function s(t,e){var i=this;if(void 0===e)return console.error(\"Invalid options provided to SymbolLayer3D\");(void 0===e.scale&&(e.scale=1),void 0===e.rotation&&(e.rotation=0),void 0===e.scaleWithMapProjection&&(e.scaleWithMapProjection=!0),(void 0===e.key||\"\"===e.key||\"object\"===a()(e.key)&&void 0===e.key.property&&void 0===e.key.generator)&&(e.key={generator:function(t,e){return e}},console.warn(\"Using array index for SymbolLayer3D key property.\")),this.parent=t,this.id=e.id,this.keyGen=r(e.key),\"string\"==typeof e.source?this.sourcePath=e.source:this.source=e.source,this.modelDirectoryGen=r(e.modelDirectory),this.modelNameGen=r(e.modelName),this.rotationGen=r(e.rotation),this.scaleGen=r(e.scale),this.models=Object.create(null),this.features=Object.create(null),this.scaleWithMapProjection=e.scaleWithMapProjection,this.loaded=!1,this.sourcePath)?(new THREE.FileLoader).load(this.sourcePath,(function(t){i.source=JSON.parse(t),i._initialize()}),(function(){return null}),(function(t){return console.error(\"Could not load SymbolLayer3D source file.\")})):this._initialize()}s.prototype={updateSourceData:function(t,e){var i=this,a={};if(!t.features)return console.error(\"updateSourceData expects a GeoJSON FeatureCollection with a 'features' property\");if(t.features.forEach((function(t,e){var r=i.keyGen(t,e);if(r in i.features)i.features[r].geojson=t,a[r]=t;else{var n=i.modelDirectoryGen(t,e),o=i.modelNameGen(t,e);i.features[r]={geojson:t,model:n+o}}})),this._addOrUpdateFeatures(this.features),e)for(key in this.features)!key in a&&this.removeFeature(key);this.source=t},removeFeature:function(t){this.parent.remove(this.features[t].rawObject),delete this.features[t]},_initialize:function(){var t=this,e=[];if(!this.modelNameGen)return console.error(\"Invalid model name definition provided to SymbolLayer3D\");if(!this.modelDirectoryGen)return console.error(\"Invalid model directory definition provided to SymbolLayer3D\");this.source.features.forEach((function(i,a){var r=t.keyGen(i,a);void 0!==t.features[r]&&console.warn(\"Features with duplicate key: \"+r);var n=t.modelDirectoryGen(i,a),o=t.modelNameGen(i,a);t.features[r]={geojson:i,model:n+o},e.push({directory:n,name:o})})),e.forEach((function(e){return t.models[e.directory+e.name]={directory:e.directory,name:e.name,loaded:!1}}));var i=Object.keys(this.models).length;console.log(\"Loading \"+i+\" models\",this.models);var a=function(){var e,a=new n,s=new o;e=m,r=function(r){if(r){for(material in r.preload(),r.materials)r.materials[material].shininess/=50;a.setMaterials(r)}a.setPath(t.models[e].directory),console.log(\"Loading model \",e),a.load(t.models[e].name+\".obj\",(function(a){t.models[e].obj=a,t.models[e].isMesh=a.isMesh,t.models[e].loaded=!0,function(e){console.log(\"Model complete!\",e),0==--i&&(t.loaded=!0,t._addOrUpdateFeatures(t.features))}(e)}),(function(){return null}),(function(t){console.error(\"Could not load SymbolLayer3D model file.\")}))},s.setPath(t.models[m].directory),s.load(t.models[m].name+\".mtl\",r,(function(){return null}),(function(t){console.warn(\"No material file found for SymbolLayer3D model \"+m),r()}))};for(m in this.models){var r;a()}},_addOrUpdateFeatures:function(t){for(key in t){var e,i=t[key],a=i.geojson.geometry.coordinates,r=this.scaleGen(i.geojson),n=this.rotationGen(i.geojson);i.rawObject?(e=i.rawObject,this.parent.moveToCoordinate(e,a,{scaleToLatitude:this.scaleWithMapProjection,preScale:r})):(i.model&&this.models[i.model]&&this.models[i.model].obj&&this.models[i.model].loaded?e=this.models[i.model].obj.clone():(console.warn(\"Model not loaded: \"+i.model),e=new THREE.Group),i.rawObject=e,this.parent.addAtCoordinate(e,a,{scaleToLatitude:this.scaleWithMapProjection,preScale:r})),e.rotation.copy(n)}}},t.exports=exports=s}.call(this,i(6)(t))},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(7),a=i.n(e);t.exports=exports=function(t){return\"object\"===a()(t)&&void 0!==t.property?function(e){return e.properties[t.property]}:\"object\"===a()(t)&&void 0!==t.generator?t.generator:function(){return t}}}.call(this,i(6)(t))},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=function(t){function e(t){var i;for(var r in a()(this,e),(i=s()(this,l()(e).call(this,t))).defaultParams={target:null,viewRotation:0,targetRotation:0,autoUpdate:!1,lockRotation:!0},i.defaultParams)void 0===i[r]&&(i[r]=i.defaultParams[r]);return i}return c()(e,t),n()(e,[{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.initCamera()}},{key:\"initCamera\",value:function(){}},{key:\"update\",value:function(){this.autoUpdate&&this.updateCamera()}},{key:\"updateCamera\",value:function(t){if(!this.target)return!1;var e=this.target.coordinates;this.lockRotation&&(t||(t=180*this.target.rotation.z/Math.PI+this.targetRotation+this.viewRotation),this.pigeonMap.cameraControl.setRotation(t)),this.pigeonMap.cameraControl.setCenter(e),this.pigeonMap.cameraControl.updateCamera()}}]),e}(i(5).default);t.exports=u}.call(this,i(6)(t))},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=function(t){function e(t){var i;for(var r in a()(this,e),(i=s()(this,l()(e).call(this,t))).defaultParams={moveSpeed:20,pitchSpeed:.1,rotateSpeed:.15},i.defaultParams)void 0===i[r]&&(i[r]=i.defaultParams[r]);return i}return c()(e,t),n()(e,[{key:\"onAdd\",value:function(t){var e=this;this.pigeonMap=t,this.map=this.pigeonMap.map,this.cameraControl=this.pigeonMap.cameraControl,this.initConfig(),this.listenEvents(),this.on(\"change\",(function(){e.pigeonMap.fire(\"change\"),e.cameraControl.updateMap()}))}},{key:\"initConfig\",value:function(){}},{key:\"listenEvents\",value:function(){var t=this;this.map.container;this.onDown=function(e){0==e.button?t.mouseStatus=\"left\":2==e.button&&(t.mouseStatus=\"right\"),t.mouseDownPosition={x:e.clientX,y:e.clientY},t.map.container.addEventListener(\"mousemove\",t.onMove)},this.onUp=function(e){t.mouseStatus=!1,t.map.container.removeEventListener(\"mousemove\",t.onMove)},this.onMove=function(e){if(t.mouseStatus){if(\"left\"==t.mouseStatus){var i=e.clientY-t.mouseDownPosition.y,a=e.clientX-t.mouseDownPosition.x,r=Math.sqrt(Math.pow(a,2)+Math.pow(i,2));if(r<.1)return!1;var n,o=(a>0?-1:1)*Math.asin(i/r)+t.map.transform.angle;n=t.pigeonMap.isUTM?t.moveSpeed/Math.pow(t.map.zoom,2):t.moveSpeed/t.map.zoom/t.map.transform.scale,t.map.center[0]+=(a>0?-1:1)*(r*Math.cos(o))*n,t.map.center[1]+=(a>0?-1:1)*(r*Math.sin(o))*n,t.cameraControl.updateMap(),t.fire(\"move\",e),t.fire(\"change\",e)}else\"right\"==t.mouseStatus&&(t.map.pitch+=t.pitchSpeed*(e.clientY-t.mouseDownPosition.y),t.map.pitch>90?t.map.pitch=90:t.map.pitch<0&&(t.map.pitch=0),t.map.rotation-=t.rotateSpeed*(e.clientX-t.mouseDownPosition.x),t.cameraControl.updateMap(),t.fire(\"rotate\",e),t.fire(\"change\",e));t.mouseDownPosition={x:e.clientX,y:e.clientY}}},this.onWheel=function(e){t.map.zoom-=e.deltaY/100,t.cameraControl.updateMap(),e.preventDefault(),t.fire(\"zoom\",e),t.fire(\"change\",e)},this.onContextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.map.container.addEventListener(\"mousedown\",this.onDown),this.map.container.addEventListener(\"mouseup\",this.onUp),this.map.container.addEventListener(\"mousemove\",this.onMove),this.map.container.addEventListener(\"wheel\",this.onWheel),this.map.container.addEventListener(\"contextmenu\",this.onContextmenu)}},{key:\"removeListenr\",value:function(){this.map.container.removeEventListener(\"mousedown\",this.onDown),this.map.container.removeEventListener(\"mouseup\",this.onUp),this.map.container.removeEventListener(\"mousemove\",this.onMove),this.map.container.removeEventListener(\"wheel\",this.onWheel),this.map.container.removeEventListener(\"contextmenu\",this.onContextmenu)}}]),e}(i(5).default);t.exports=u}.call(this,i(6)(t))},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=function(t){function e(t){var i;for(var r in a()(this,e),(i=s()(this,l()(e).call(this,t))).defaultParams={fontSize:\"14px\",color:\"#000000\",canvasRender:!1},i.texts=[],i.textId=0,i.defaultParams)void 0===i[r]&&(i[r]=i.defaultParams[r]);return i}return c()(e,t),n()(e,[{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.canvasRender?this.initCanvas():this.initDom();var e=this;function i(){e.updateText()}this.change=i,this.pigeonMap.on(\"change\",i)}},{key:\"initDom\",value:function(){this.container=this.pigeonMap.map.container;var t=document.createElement(\"div\");t.id=\"text_layer_\"+this.id,t.className=\"pigeonGL-text-layer\",t.setAttribute(\"width\",this.pigeonMap.map.width),t.setAttribute(\"height\",this.pigeonMap.map.height),t.style.position=\"absolute\",t.style.top=\"0\",t.style.left=\"0\",t.style.zIndex=++this.pigeonMap.zIndex,this.dom=t,this.container.appendChild(t)}},{key:\"initCanvas\",value:function(){this.container=this.pigeonMap.map.container;var t=document.createElement(\"canvas\");t.id=\"text_layer_\"+this.id,this.container.appendChild(t),t.setAttribute(\"width\",this.pigeonMap.map.width),t.setAttribute(\"height\",this.pigeonMap.map.height),t.style.position=\"absolute\",t.style.top=\"0\",t.style.left=\"0\",t.style.zIndex=++this.pigeonMap.zIndex,this.canvas=t}},{key:\"addText\",value:function(t){return(t=Object.assign({},t)).id=t.id||\"_text_\"+this.textId++,this.texts.push(t),t}},{key:\"drawText\",value:function(){this.canvasRender?this.drawCanvasText():this.drawDomText()}},{key:\"drawDomText\",value:function(){for(var t in this.dom.innerHTML=\"\",this.texts){var e=this.pigeonMap.projectToScreen(this.texts[t].lnglat),i=document.createElement(\"span\");for(var a in i.id=this.texts[t].id,i.innerHTML=this.texts[t].text,this.dom.appendChild(i),i.style.position=\"absolute\",i.style.top=e.y+\"px\",i.style.left=e.x+\"px\",this.texts[t].style)i.style[a]=this.texts[t].style[a]}}},{key:\"drawCanvasText\",value:function(){var t=this.canvas.getContext(\"2d\");for(var e in t.clearRect(0,0,this.canvas.width,this.canvas.height),this.texts){var i=this.pigeonMap.projectToScreen(this.texts[e].lnglat);t.font=this.texts[e].font||this.font,t.fillStyle=this.texts[e].color||this.color,t.fillText(this.texts[e].text,i.x,i.y)}}},{key:\"updateDomText\",value:function(){var t=this.dom.querySelectorAll(\"span\");for(var e in this.texts){var i=this.pigeonMap.projectToScreen(this.texts[e].lnglat);t[e].style.top=i.y+\"px\",t[e].style.left=i.x+\"px\"}}},{key:\"removeText\",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return this.texts.splice(e,1),void this.drawText()}},{key:\"update\",value:function(){}},{key:\"updateText\",value:function(){this.canvasRender?this.drawCanvasText():this.updateDomText()}},{key:\"getText\",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return this.text[e]}},{key:\"onRemove\",value:function(){this.pigeonMap.off(\"change\",this.change),this._listeners=null}},{key:\"getTextIndex\",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return e}}]),e}(i(5).default);t.exports=u}.call(this,i(6)(t))},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=i(5);t.exports=function(t){function e(t){var i;return a()(this,e),(i=s()(this,l()(e).call(this,t))).noVR=!1,i.vrStatus=\"not suppert VR\",i.listenEvents(),i.getVRDisplays(),i}return c()(e,t),n()(e,[{key:\"getVRDisplays\",value:function(){var t=this;navigator.getVRDisplays&&navigator.getVRDisplays().then((function(e){e.length>0?(t.device=e[0],t.renderer.vr.enabled=!0,t.pigeonMap.renderer.vr.setDevice(t.device),t.frameData=new VRFrameData):(t.vrStatus=\"noDisplay\",console.warn(\"no vr displays\"))})).catch((function(t){console.warn(\"Unable to get VR Displays\")}))}},{key:\"listenEvents\",value:function(){var t=this;window.addEventListener(\"vrdisplayconnect\",(function(e){t.device=e.display||e.detail.display,t.status,t.renderer.vr.enabled=!0,t.fire(\"connected\",t.device)}),!1),window.addEventListener(\"vrdisplaydisconnect\",(function(e){t.status,t.renderer.vr.enabled=!1,t.fire(\"disconnet\",t.device)}),!1),window.addEventListener(\"vrdisplaypresentchange\",(function(e){t.device=e.display||e.detail.display,t.fire(\"statuschange\",t.device)}),!1)}},{key:\"enterVR\",value:function(){this.device.requestPresent([{source:this.renderer.domElement}])}},{key:\"exitVR\",value:function(){this.device.exitPresent()}},{key:\"createButton\",value:function(t){var e=this;t||((t=document.createElement(\"button\")).style.position=\"absolute\",t.style.bottom=\"20px\",t.style.padding=\"12px 6px\",t.style.border=\"1px solid #fff\",t.style.borderRadius=\"4px\",t.style.background=\"transparent\",t.style.color=\"#fff\",t.style.textAlign=\"center\",t.style.opacity=\"0.5\",t.style.outline=\"none\",t.style.zIndex=\"9999\",t.style.cursor=\"auto\",t.style.left=\"calc(50% - 75px)\",t.style.width=\"150px\",t.textContent=\"Enter VR\",document.body.appendChild(t)),t.addEventListener(\"click\",(function(){e.device&&e.enterVR()}))}},{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.renderer=t.renderer,this.initVRRenderer()}},{key:\"initVRRenderer\",value:function(){}}]),e}(u.default)}.call(this,i(6)(t))},function(t,e,i){\"use strict\";i.r(e),function(t){var e=i(0),a=i.n(e),r=i(1),n=i.n(r),o=i(2),s=i.n(o),h=i(3),l=i.n(h),p=i(4),c=i.n(p),u=function(t){function e(t){var i;return a()(this,e),(i=s()(this,l()(e).call(this,t))).lanePoints=[],i.initPoints(),i}return c()(e,t),n()(e,[{key:\"initPoints\",value:function(){this.material=new THREE.PointsMaterial({color:16777215,size:10}),this.pointsGeometry=new THREE.BufferGeometry,this.points=new THREE.Points(this.pointsGeometry,this.material)}},{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.pigeonMap.world.add(this.points)}},{key:\"drawPoints\",value:function(t){this.baseLngLat=t[0],this.baseXYZ=this.pigeonMap.projectToWorld(this.baseLngLat);var e,i=[],a=[],r=[];for(var n in t)e=this.pigeonMap.projectToWorld(t[n]),i.push(e.x-this.baseXYZ.x,e.y-this.baseXYZ.y,e.z-this.baseXYZ.z),r.push(t[n]),a.push(n);this.points.geometry.addAttribute(\"position\",new THREE.Float32BufferAttribute(i,3)),this.points.geometry.computeBoundingSphere(),this.points.position.x=this.baseXYZ.x,this.points.position.y=this.baseXYZ.y,this.points.position.z=this.baseXYZ.z}}]),e}(i(5).default);t.exports=u}.call(this,i(6)(t))}]);","extractedComments":[]}