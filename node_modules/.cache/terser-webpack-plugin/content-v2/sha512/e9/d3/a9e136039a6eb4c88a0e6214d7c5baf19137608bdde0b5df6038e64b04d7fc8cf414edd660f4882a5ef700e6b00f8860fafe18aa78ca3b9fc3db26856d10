{"code":"!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t(require(\"three\")):\"function\"==typeof define&&define.amd?define([\"three\"],t):\"object\"==typeof exports?exports.PigeonGL=t(require(\"three\")):e.PigeonGL=t(e.three)}(window,(function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=11)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},function(e,t,n){var i=n(6),a=n(16);e.exports=function(e,t){return!t||\"object\"!==i(t)&&\"function\"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var i=n(17);e.exports=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=function(){function e(t){a()(this,e),this.layers=[];for(var n in this._userConfig=t,t)this[n]=t[n]}return r()(e,[{key:\"on\",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:\"fire\",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n)for(var i=n.slice(0),a=0,o=i.length;a<o;a++)i[a].call(this,t)}}},{key:\"off\",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n)if(t){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}else this._listeners[e]=[]}}},{key:\"initConfig\",value:function(e){}},{key:\"onAdd\",value:function(e){this.pigeonMap=e}},{key:\"update\",value:function(){}},{key:\"onRemove\",value:function(){this._listeners&&(this._listeners=[])}},{key:\"addLayer\",value:function(e){e.id=++this._layerid,this.layers.push(e),e.onAdd(this)}},{key:\"removeLayer\",value:function(e){for(var t in this.layers)if(this.layers[t].id==e.id)return this.layers[t].onRemove(),void this.layers.splice(t,1)}},{key:\"getLayerById\",value:function(e){for(var t=0;t<this.layers.length;t++)if(this.layer.id===e)return layer}}]),e}();t.default=s},function(e,t){function n(e){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(t){return\"function\"==typeof Symbol&&\"symbol\"===n(Symbol.iterator)?e.exports=i=function(e){return n(e)}:e.exports=i=function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":n(e)},i(t)}e.exports=i},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=(n(8),n(18)),c=function(){function e(t){a()(this,e),this.scope=t,this.map=t.map,this.camera=t.camera,this.active=!0,this.world=t.world||new THREE.Group,this.world.position.x=this.world.position.y=0,this.camera.matrixAutoUpdate=!1,this.update()}return r()(e,[{key:\"update\",value:function(e){this.map=Object.assign(this.map,e),this.initMapTransform(),this.updateCamera()}},{key:\"listenMapChange\",value:function(){this.update(this.map)}},{key:\"initMapTransform\",value:function(){var e={};e.width=this.map.width,e.height=this.map.height,e.zHeight=this.map.zHeight||0,e.x=this.map.center[0],e.y=this.map.center[1],e.z=this.map.center[2]||this.getZ(this.map.zoom),e._pitch=this.map.pitch*Math.PI/180||0,e.angle=this.map.rotation*Math.PI/180||0,this.map.transform=e}},{key:\"getZ\",value:function(e){return e}},{key:\"setCenter\",value:function(e){this.map.center=e,this.initMapTransform()}},{key:\"setRotation\",value:function(e){this.map.rotation=e,this.map.transform.angle=this.map.rotation*Math.PI/180}},{key:\"setPitch\",value:function(e){this.map.pitch=e,this.map.transform._pitch=this.map.pitch*Math.PI/180}},{key:\"updateCamera\",value:function(e){var t=Math.abs(this.map.transform.z)+this.map.transform.zHeight,n=this.map.fov||.6435011087932844,i=t,a=n/2,o=Math.PI/2+this.map.transform._pitch,r=Math.sin(a)*i/Math.sin(Math.PI-o-a),c=1.01*(Math.cos(Math.PI/2-this.map.transform._pitch)*r+i);this.camera.projectionMatrix=s.makePerspectiveMatrix(n,this.map.transform.width/this.map.transform.height,1,c);var u=new THREE.Matrix4,h=(new THREE.Matrix4).makeTranslation(0,0,t),l=(new THREE.Matrix4).makeRotationX(this.map.transform._pitch),p=(new THREE.Matrix4).makeRotationZ(this.map.transform.angle);u.premultiply(h).premultiply(l).premultiply(p),this.camera.matrixWorld.copy(u),this.world.position.x=-this.map.transform.x,this.world.position.y=-this.map.transform.y}}]),e}();t.default=c},function(e,t){var n=512*Math.pow(2,0);e.exports={WORLD_SIZE_RATIO:0,WORLD_SIZE:n,PROJECTION_WORLD_SIZE:n/(6378137*Math.PI)/2,MERCATOR_A:6378137,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_CIRCUMFERENCE:40075e3,DISTANCE:200}},function(t,n){t.exports=e},function(e,t,n){var i=n(25),a=n(26),o=n(27);e.exports=function(e){return i(e)||a(e)||o()}},function(e,t,n){\"use strict\";n.r(t);var i=n(9);window.THREE=i;var a={OrbitControls:n(12).default,MTLLoader:n(13),OBJLoader:n(14),Map:n(15).default,Layer:n(5).default,CameraControl:n(7).default,ThirdPersonView:n(19).default,MapControl:n(20).default,TextLayer:n(21).default,VRLayer:n(22).default,CloudPoints:n(23).default,Text:n(24).default};window.PigeonGL=a,t.default=a},function(e,t,n){\"use strict\";n.r(t);var i=function(e,t){var n,i,a,o,r;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),p=l.NONE},this.update=(n=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=i.clone().inverse(),o=new THREE.Vector3,r=new THREE.Quaternion,function(){var e=s.object.position;return n.copy(e).sub(s.target),n.applyQuaternion(i),m.setFromVector3(n),s.autoRotate&&p===l.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),m.theta+=f.theta,m.phi+=f.phi,m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=v,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),s.target.add(g),n.setFromSpherical(m),n.applyQuaternion(a),e.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(f.theta*=1-s.dampingFactor,f.phi*=1-s.dampingFactor):f.set(0,0,0),v=1,g.set(0,0,0),!!(y||o.distanceToSquared(s.object.position)>d||8*(1-r.dot(s.object.quaternion))>d)&&(s.dispatchEvent(c),o.copy(s.object.position),r.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener(\"contextmenu\",W,!1),s.domElement.removeEventListener(\"mousedown\",z,!1),s.domElement.removeEventListener(\"wheel\",F,!1),s.domElement.removeEventListener(\"touchstart\",N,!1),s.domElement.removeEventListener(\"touchend\",G,!1),s.domElement.removeEventListener(\"touchmove\",Z,!1),document.removeEventListener(\"mousemove\",D,!1),document.removeEventListener(\"mouseup\",V,!1),window.removeEventListener(\"keydown\",U,!1)};var s=this,c={type:\"change\"},u={type:\"start\"},h={type:\"end\"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},p=l.NONE,d=1e-6,m=new THREE.Spherical,f=new THREE.Spherical,v=1,g=new THREE.Vector3,y=!1,b=new THREE.Vector2,E=new THREE.Vector2,x=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,R=new THREE.Vector2,k=new THREE.Vector2,_=new THREE.Vector2;function O(){return Math.pow(.95,s.zoomSpeed)}function P(e){f.theta-=e}function j(e){f.phi-=e}var L,C=(L=new THREE.Vector3,function(e,t){L.setFromMatrixColumn(t,0),L.multiplyScalar(-e),g.add(L)}),H=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),g.add(e)}}(),S=function(){var e=new THREE.Vector3;return function(t,n){var i=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var a=s.object.position;e.copy(a).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),C(2*t*o/i.clientHeight,s.object.matrix),H(2*n*o/i.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(C(t*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),H(n*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.\"),s.enablePan=!1)}}();function A(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\"),s.enableZoom=!1)}function I(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\"),s.enableZoom=!1)}function z(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.ORBIT:if(!1===s.enableRotate)return;!function(e){b.set(e.clientX,e.clientY)}(e),p=l.ROTATE;break;case s.mouseButtons.ZOOM:if(!1===s.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),p=l.DOLLY;break;case s.mouseButtons.PAN:if(!1===s.enablePan)return;!function(e){w.set(e.clientX,e.clientY)}(e),p=l.PAN}p!==l.NONE&&(document.addEventListener(\"mousemove\",D,!1),document.addEventListener(\"mouseup\",V,!1),s.dispatchEvent(u))}}function D(e){if(!1!==s.enabled)switch(e.preventDefault(),p){case l.ROTATE:if(!1===s.enableRotate)return;!function(e){E.set(e.clientX,e.clientY),x.subVectors(E,b);var t=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*x.x/t.clientWidth*s.rotateSpeed),j(2*Math.PI*x.y/t.clientHeight*s.rotateSpeed),b.copy(E),s.update()}(e);break;case l.DOLLY:if(!1===s.enableZoom)return;!function(e){k.set(e.clientX,e.clientY),_.subVectors(k,R),_.y>0?A(O()):_.y<0&&I(O()),R.copy(k),s.update()}(e);break;case l.PAN:if(!1===s.enablePan)return;!function(e){T.set(e.clientX,e.clientY),M.subVectors(T,w),S(M.x,M.y),w.copy(T),s.update()}(e)}}function V(e){!1!==s.enabled&&(document.removeEventListener(\"mousemove\",D,!1),document.removeEventListener(\"mouseup\",V,!1),s.dispatchEvent(h),p=l.NONE)}function F(e){!1===s.enabled||!1===s.enableZoom||p!==l.NONE&&p!==l.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(u),function(e){e.deltaY<0?I(O()):e.deltaY>0&&A(O()),s.update()}(e),s.dispatchEvent(h))}function U(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:S(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:S(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:S(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:S(-s.keyPanSpeed,0),s.update()}}(e)}function N(e){if(!1!==s.enabled){switch(e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){b.set(e.touches[0].pageX,e.touches[0].pageY)}(e),p=l.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);R.set(0,i)}(e),p=l.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY)}(e),p=l.TOUCH_PAN;break;default:p=l.NONE}p!==l.NONE&&s.dispatchEvent(u)}}function Z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(p!==l.TOUCH_ROTATE)return;!function(e){E.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(E,b);var t=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*x.x/t.clientWidth*s.rotateSpeed),j(2*Math.PI*x.y/t.clientHeight*s.rotateSpeed),b.copy(E),s.update()}(e);break;case 2:if(!1===s.enableZoom)return;if(p!==l.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);k.set(0,i),_.subVectors(k,R),_.y>0?I(O()):_.y<0&&A(O()),R.copy(k),s.update()}(e);break;case 3:if(!1===s.enablePan)return;if(p!==l.TOUCH_PAN)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY),M.subVectors(T,w),S(M.x,M.y),w.copy(T),s.update()}(e);break;default:p=l.NONE}}function G(e){!1!==s.enabled&&(s.dispatchEvent(h),p=l.NONE)}function W(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener(\"contextmenu\",W,!1),s.domElement.addEventListener(\"mousedown\",z,!1),s.domElement.addEventListener(\"wheel\",F,!1),s.domElement.addEventListener(\"touchstart\",N,!1),s.domElement.addEventListener(\"touchend\",G,!1),s.domElement.addEventListener(\"touchmove\",Z,!1),window.addEventListener(\"keydown\",U,!1),this.update()};(i.prototype=Object.create(THREE.EventDispatcher.prototype)).constructor=i,Object.defineProperties(i.prototype,{center:{get:function(){return console.warn(\"OrbitControls: .center has been renamed to .target\"),this.target}},noZoom:{get:function(){return console.warn(\"OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.\"),!this.enableZoom},set:function(e){console.warn(\"OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.\"),this.enableZoom=!e}},noRotate:{get:function(){return console.warn(\"OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.\"),!this.enableRotate},set:function(e){console.warn(\"OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.\"),this.enableRotate=!e}},noPan:{get:function(){return console.warn(\"OrbitControls: .noPan has been deprecated. Use .enablePan instead.\"),!this.enablePan},set:function(e){console.warn(\"OrbitControls: .noPan has been deprecated. Use .enablePan instead.\"),this.enablePan=!e}},noKeys:{get:function(){return console.warn(\"OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.\"),!this.enableKeys},set:function(e){console.warn(\"OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.\"),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn(\"OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.\"),!this.enableDamping},set:function(e){console.warn(\"OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.\"),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn(\"OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.\"),this.dampingFactor},set:function(e){console.warn(\"OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.\"),this.dampingFactor=e}}}),t.default=i},function(e,t){var n=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager};n.prototype={constructor:n,load:function(e,t,n,i){var a=this,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.load(e,(function(e){t(a.parse(e))}),n,i)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn(\"THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.\"),this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split(\"\\n\"),i={},a=/\\s+/,o={},r=0;r<t.length;r++){var s=t[r];if(0!==(s=s.trim()).length&&\"#\"!==s.charAt(0)){var c=s.indexOf(\" \"),u=c>=0?s.substring(0,c):s;u=u.toLowerCase();var h=c>=0?s.substring(c+1):\"\";if(h=h.trim(),\"newmtl\"===u)i={name:h},o[h]=i;else if(i)if(\"ka\"===u||\"kd\"===u||\"ks\"===u){var l=h.split(a,3);i[u]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else i[u]=h}}var p=new n.MaterialCreator(this.texturePath||this.path,this.materialOptions);return p.setCrossOrigin(this.crossOrigin),p.setManager(this.manager),p.setMaterials(o),p}},(n.MaterialCreator=function(e,t){this.baseUrl=e||\"\",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping}).prototype={constructor:n.MaterialCreator,setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var n in e){var i=e[n],a={};for(var o in t[n]=a,i){var r=!0,s=i[o],c=o.toLowerCase();switch(c){case\"kd\":case\"ka\":case\"ks\":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(r=!1)}r&&(a[c]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,n=this.materialsInfo[e],i={name:e,side:this.side};function a(e,n){if(!i[e]){var a,o,r=t.getTextureParams(n,i),s=t.loadTexture((a=t.baseUrl,\"string\"!=typeof(o=r.url)||\"\"===o?\"\":/^https?:\\/\\//i.test(o)?o:a+o));s.repeat.copy(r.scale),s.offset.copy(r.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,i[e]=s}}for(var o in n){var r=n[o];if(\"\"!==r)switch(o.toLowerCase()){case\"kd\":i.color=(new THREE.Color).fromArray(r);break;case\"ks\":i.specular=(new THREE.Color).fromArray(r);break;case\"map_kd\":a(\"map\",r);break;case\"map_ks\":a(\"specularMap\",r);break;case\"map_bump\":case\"bump\":a(\"bumpMap\",r);break;case\"ns\":i.shininess=parseFloat(r);break;case\"d\":r<1&&(i.opacity=r,i.transparent=!0);break;case\"Tr\":r>0&&(i.opacity=1-r,i.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(i),this.materials[e]},getTextureParams:function(e,t){var n,i={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},a=e.split(/\\s+/);return(n=a.indexOf(\"-bm\"))>=0&&(t.bumpScale=parseFloat(a[n+1]),a.splice(n,2)),(n=a.indexOf(\"-s\"))>=0&&(i.scale.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),(n=a.indexOf(\"-o\"))>=0&&(i.offset.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),i.url=a.join(\" \").trim(),i},loadTexture:function(e,t,n,i,a){var o,r=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===r&&(r=new THREE.TextureLoader(s)),r.setCrossOrigin&&r.setCrossOrigin(this.crossOrigin),o=r.load(e,n,i,a),void 0!==t&&(o.mapping=t),o}},e.exports=n},function(e,t){var n=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,normal_pattern:/^vn\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,uv_pattern:/^vt\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,face_vertex:/^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,face_vertex_uv:/^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,face_vertex_uv_normal:/^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,face_vertex_normal:/^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,object_pattern:/^[og]\\s*(.+)?/,smoothing_pattern:/^s\\s+(\\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};n.prototype={constructor:n,load:function(e,t,n,i){var a=this,o=new THREE.FileLoader(a.manager);o.setPath(this.path),o.load(e,(function(e){t(a.parse(e))}),n,i)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&\"function\"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&\"function\"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||\"\",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:e||\"\",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:\"\",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:\"number\"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:\"\",smooth:this.smooth}),t}},n&&n.name&&\"function\"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&\"function\"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var i=this.vertices,a=this.object.geometry.vertices;a.push(i[e+0]),a.push(i[e+1]),a.push(i[e+2]),a.push(i[t+0]),a.push(i[t+1]),a.push(i[t+2]),a.push(i[n+0]),a.push(i[n+1]),a.push(i[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var i=this.normals,a=this.object.geometry.normals;a.push(i[e+0]),a.push(i[e+1]),a.push(i[e+2]),a.push(i[t+0]),a.push(i[t+1]),a.push(i[t+2]),a.push(i[n+0]),a.push(i[n+1]),a.push(i[n+2])},addUV:function(e,t,n){var i=this.uvs,a=this.object.geometry.uvs;a.push(i[e+0]),a.push(i[e+1]),a.push(i[t+0]),a.push(i[t+1]),a.push(i[n+0]),a.push(i[n+1])},addUVLine:function(e){var t=this.uvs,n=this.object.geometry.uvs;n.push(t[e+0]),n.push(t[e+1])},addFace:function(e,t,n,i,a,o,r,s,c,u,h,l){var p,d=this.vertices.length,m=this.parseVertexIndex(e,d),f=this.parseVertexIndex(t,d),v=this.parseVertexIndex(n,d);if(void 0===i?this.addVertex(m,f,v):(p=this.parseVertexIndex(i,d),this.addVertex(m,f,p),this.addVertex(f,v,p)),void 0!==a){var g=this.uvs.length;m=this.parseUVIndex(a,g),f=this.parseUVIndex(o,g),v=this.parseUVIndex(r,g),void 0===i?this.addUV(m,f,v):(p=this.parseUVIndex(s,g),this.addUV(m,f,p),this.addUV(f,v,p))}if(void 0!==c){var y=this.normals.length;m=this.parseNormalIndex(c,y),f=c===u?m:this.parseNormalIndex(u,y),v=c===h?m:this.parseNormalIndex(h,y),void 0===i?this.addNormal(m,f,v):(p=this.parseNormalIndex(l,y),this.addNormal(m,f,p),this.addNormal(f,v,p))}},addLineGeometry:function(e,t){this.object.geometry.type=\"Line\";for(var n=this.vertices.length,i=this.uvs.length,a=0,o=e.length;a<o;a++)this.addVertexLine(this.parseVertexIndex(e[a],n));var r=0;for(o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return e.startObject(\"\",!1),e},parse:function(e){var t=this._createParserState();-1!==e.indexOf(\"\\r\\n\")&&(e=e.replace(/\\r\\n/g,\"\\n\")),-1!==e.indexOf(\"\\\\\\n\")&&(e=e.replace(/\\\\\\n/g,\"\"));for(var n=e.split(\"\\n\"),i=\"\",a=\"\",o=\"\",r=[],s=\"function\"==typeof\"\".trimLeft,c=0,u=n.length;c<u;c++)if(i=n[c],0!==(i=s?i.trimLeft():i.trim()).length&&\"#\"!==(a=i.charAt(0)))if(\"v\"===a)if(\" \"===(o=i.charAt(1))&&null!==(r=this.regexp.vertex_pattern.exec(i)))t.vertices.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));else if(\"n\"===o&&null!==(r=this.regexp.normal_pattern.exec(i)))t.normals.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));else{if(\"t\"!==o||null===(r=this.regexp.uv_pattern.exec(i)))throw new Error(\"Unexpected vertex/normal/uv line: '\"+i+\"'\");t.uvs.push(parseFloat(r[1]),parseFloat(r[2]))}else if(\"f\"===a)if(null!==(r=this.regexp.face_vertex_uv_normal.exec(i)))t.addFace(r[1],r[4],r[7],r[10],r[2],r[5],r[8],r[11],r[3],r[6],r[9],r[12]);else if(null!==(r=this.regexp.face_vertex_uv.exec(i)))t.addFace(r[1],r[3],r[5],r[7],r[2],r[4],r[6],r[8]);else if(null!==(r=this.regexp.face_vertex_normal.exec(i)))t.addFace(r[1],r[3],r[5],r[7],void 0,void 0,void 0,void 0,r[2],r[4],r[6],r[8]);else{if(null===(r=this.regexp.face_vertex.exec(i)))throw new Error(\"Unexpected face line: '\"+i+\"'\");t.addFace(r[1],r[2],r[3],r[4])}else if(\"l\"===a){var h=i.substring(1).trim().split(\" \"),l=[],p=[];if(-1===i.indexOf(\"/\"))l=h;else for(var d=0,m=h.length;d<m;d++){var f=h[d].split(\"/\");\"\"!==f[0]&&l.push(f[0]),\"\"!==f[1]&&p.push(f[1])}t.addLineGeometry(l,p)}else if(null!==(r=this.regexp.object_pattern.exec(i))){var v=(\" \"+r[0].substr(1).trim()).substr(1);t.startObject(v)}else if(this.regexp.material_use_pattern.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(i))t.materialLibraries.push(i.substring(7).trim());else{if(null===(r=this.regexp.smoothing_pattern.exec(i))){if(\"\\0\"===i)continue;throw new Error(\"Unexpected line: '\"+i+\"'\")}var g=r[1].trim().toLowerCase();t.object.smooth=\"1\"===g||\"on\"===g,(P=t.object.currentMaterial())&&(P.smooth=t.object.smooth)}t.finalize();var y=new THREE.Group;y.materialLibraries=[].concat(t.materialLibraries);for(c=0,u=t.objects.length;c<u;c++){var b=t.objects[c],E=b.geometry,x=b.materials,w=\"Line\"===E.type;if(0!==E.vertices.length){var T=new THREE.BufferGeometry;T.addAttribute(\"position\",new THREE.BufferAttribute(new Float32Array(E.vertices),3)),E.normals.length>0?T.addAttribute(\"normal\",new THREE.BufferAttribute(new Float32Array(E.normals),3)):T.computeVertexNormals(),E.uvs.length>0&&T.addAttribute(\"uv\",new THREE.BufferAttribute(new Float32Array(E.uvs),2));for(var M,R=[],k=0,_=x.length;k<_;k++){var O=x[k],P=void 0;if(null!==this.materials&&(P=this.materials.create(O.name),w&&P&&!(P instanceof THREE.LineBasicMaterial))){var j=new THREE.LineBasicMaterial;j.copy(P),j.lights=!1,P=j}P||((P=w?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=O.name),P.flatShading=O.smooth?THREE.SmoothShading:THREE.FlatShading,R.push(P)}if(R.length>1){for(k=0,_=x.length;k<_;k++){O=x[k];T.addGroup(O.groupStart,O.groupCount,k)}var L=new THREE.MultiMaterial(R);M=w?new THREE.LineSegments(T,L):new THREE.Mesh(T,L)}else M=w?new THREE.LineSegments(T,R[0]):new THREE.Mesh(T,R[0]);M.name=b.name,y.add(M)}}return y}},e.exports=n},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=n(7),m=n(5),f=n(8),v=function(e){function t(e){var n;return a()(this,t),(n=c()(this,h()(t).call(this)))._layerid=0,n.zIndex=1e3,n.status=\"running\",n.type=\"gps\",n.layers=[],n.clock=new THREE.Clock,n.clock.start(),n.initMap(e),n.initWorld(),n.map.hasGround&&n.addGround(),n.update(),n}return p()(t,e),r()(t,[{key:\"initMap\",value:function(e){this.map=Object.assign({rotation:0,width:1e3,height:600,pitch:45,zoom:21,center:[0,0]},e)}},{key:\"initWorld\",value:function(){this.renderer=new THREE.WebGLRenderer(Object.assign({alpha:!0,antialias:!0},this.map.rendererOptions)),this.renderer.setSize(this.map.width,this.map.height),this.map.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position=\"relative\",this.renderer.domElement.style[\"pointer-events\"]=\"none\",this.renderer.domElement.style[\"z-index\"]=++this.zIndex,this.scene=new THREE.Scene(Object.assign({},this.map.sceneOptions||{})),this.camera=new THREE.PerspectiveCamera(45,this.map.width/this.map.height,1e-6,5e9),this.layers=[],this.world=new THREE.Group,this.scene.add(this.world),this.camera.position.z=10,this.camera.position.x=this.map.center[0],this.camera.position.y=this.map.center[1],this.cameraControl=new d.default(this)}},{key:\"moveTo\",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.preScale;return e.userData.isGeoGroup?n=e:e.parent&&e.parent.userData.isGeoGroup&&(n=e.parent),n.scale.copy(a||1),n.position.copy(this.projectToWorld(t)),e.coordinates=t,e}},{key:\"update\",value:function(){var e,t=this,n=this.clock.getDelta();for(var i in this.layers)this.layers[i].update&&this.layers[i].update(n);this.renderer.render(this.scene,this.camera),(e=this.renderer.vr.getDevice())?this.animationframe=e.requestAnimationFrame((function(e){\"stop\"!=t.status&&t.update(n,e)})):this.animationframe=requestAnimationFrame((function(e){\"stop\"!=t.status&&t.update(n,e)}))}},{key:\"projectToWorld\",value:function(e){return{x:e[0],y:e[1],z:e[2]||0}}},{key:\"unprojectFromWorld\",value:function(e){return[e.x,e.y,e.z]}},{key:\"projectToScreen\",value:function(e){var t=Object.assign({},e);t[1]=-t[1];var n=this.projectToWorld(t),i=this.world.getWorldPosition().clone().add(n).project(this.camera),a=this.map.width/2,o=this.map.height/2;return{x:Math.round(i.x*a+a),y:this.map.height-Math.round(i.y*o+o)}}},{key:\"unprojectFromScreen\",value:function(e){var t=this.map.width/2,n=this.map.height/2,i=-(e.x-t)/t,a=(this.map.height-e.y-n)/n,o=new THREE.Vector3(i,a,0).unproject(this.camera),r=this.world.getWorldPosition().clone(),s=this.unprojectFromWorld(o.sub(r));return s[1]=-s[1],s}},{key:\"add\",value:function(e,t,n){var i=new THREE.Group;return i.userData.isGeoGroup=!0,i.add(e),this.world.add(i),this.moveTo(e,t,n),e}},{key:\"addGround\",value:function(){var e=new THREE.PlaneGeometry(f.WORLD_SIZE,f.WORLD_SIZE),t=new THREE.MeshPhongMaterial({color:this.map.groundColor||6710886,shininess:30}),n=new THREE.Mesh(e,t);n.position.z=-.01,this.add(n,this.map.center,{scaleToLatitude:!0,preScale:100})}},{key:\"remove\",value:function(e){this.world.remove(e)}},{key:\"setupDefaultLights\",value:function(){this.scene.add(new THREE.AmbientLight(13421772));var e=new THREE.DirectionalLight(16777215,.5);e.position.set(0,800,1e3),e.matrixWorldNeedsUpdate=!0,this.world.add(e)}}]),t}(m.default);t.default=v},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}},function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,i)}e.exports=n},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"prettyPrintMatrix\",(function(){return o})),n.d(t,\"makePerspectiveMatrix\",(function(){return r})),n.d(t,\"radify\",(function(){return s})),n.d(t,\"degreeify\",(function(){return c}));var i=n(6),a=n.n(i);function o(e){for(var t=0;t<4;t++)e[t],e[t+4],e[t+8],e[t+12]}function r(e,t,n,i){var a=new THREE.Matrix4,o=1/Math.tan(e/2),r=1/(n-i);return a.elements[0]=o/t,a.elements[1]=0,a.elements[2]=0,a.elements[3]=0,a.elements[4]=0,a.elements[5]=o,a.elements[6]=0,a.elements[7]=0,a.elements[8]=0,a.elements[9]=0,a.elements[10]=(i+n)*r,a.elements[11]=-1,a.elements[12]=0,a.elements[13]=0,a.elements[14]=2*i*n*r,a.elements[15]=0,a}function s(e){return\"object\"===a()(e)?e.map((function(e){return 2*Math.PI*e/360})):2*Math.PI*e/360}function c(e){return 360*e/(2*Math.PI)}},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(e){function t(e){var n;for(var i in a()(this,t),(n=c()(this,h()(t).call(this,e))).defaultParams={target:null,viewRotation:0,targetRotation:0,autoUpdate:!1,lockRotation:!0},n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(t,e),r()(t,[{key:\"onAdd\",value:function(e){this.pigeonMap=e,this.initCamera()}},{key:\"initCamera\",value:function(){}},{key:\"update\",value:function(){this.autoUpdate&&this.updateCamera()}},{key:\"updateCamera\",value:function(e){if(!this.target)return!1;var t=this.target.coordinates;this.lockRotation&&(e||(e=180*this.target.rotation.z/Math.PI+this.targetRotation+this.viewRotation),this.pigeonMap.cameraControl.setRotation(e)),this.pigeonMap.cameraControl.setCenter(t),this.pigeonMap.cameraControl.updateCamera()}}]),t}(n(5).default);t.default=d},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(e){function t(e){var n;for(var i in a()(this,t),(n=c()(this,h()(t).call(this,e))).defaultParams={zoomBase:600,moveSpeed:1,pitchSpeed:.1,rotateSpeed:.15},n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(t,e),r()(t,[{key:\"onAdd\",value:function(e){var t=this;this.pigeonMap=e,this.map=this.pigeonMap.map,this.cameraControl=this.pigeonMap.cameraControl,this.initConfig(),this.listenEvents(),this.on(\"change\",(function(){t.pigeonMap.fire(\"change\"),t.cameraControl.update()}))}},{key:\"initConfig\",value:function(){}},{key:\"listenEvents\",value:function(){var e=this;this.onDown=function(t){0==t.button?e.mouseStatus=\"left\":2==t.button&&(e.mouseStatus=\"right\"),e.mouseDownPosition={x:t.clientX,y:t.clientY},e.map.container.addEventListener(\"mousemove\",e.onMove)},this.onUp=function(t){e.mouseStatus=!1,e.map.container.removeEventListener(\"mousemove\",e.onMove)},this.onMove=function(t){if(e.mouseStatus){if(\"left\"==e.mouseStatus){var n=t.clientY-e.mouseDownPosition.y,i=t.clientX-e.mouseDownPosition.x,a=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));if(a<.1)return!1;var o=(i>0?-1:1)*Math.asin(n/a)+e.map.transform.angle,r=e.moveSpeed*(e.map.zoom/(e.zoomBase+Math.pow(e.map.zoom,2)));e.map.center[0]+=(i>0?-1:1)*(a*Math.cos(o))*r,e.map.center[1]+=(i>0?-1:1)*(a*Math.sin(o))*r,e.cameraControl.update(),e.fire(\"move\",t),e.fire(\"change\",t)}else\"right\"==e.mouseStatus&&(e.map.pitch+=e.pitchSpeed*(t.clientY-e.mouseDownPosition.y),e.map.pitch>90?e.map.pitch=90:e.map.pitch<0&&(e.map.pitch=0),e.map.rotation-=e.rotateSpeed*(t.clientX-e.mouseDownPosition.x),e.cameraControl.update(),e.fire(\"rotate\",t),e.fire(\"change\",t));e.mouseDownPosition={x:t.clientX,y:t.clientY}}},this.onWheel=function(t){if(e.map.zoom-=t.deltaY*e.map.zoom/e.zoomBase,e.map.zoom<5)return e.map.zoom=5;e.cameraControl.update(),t.preventDefault(),e.fire(\"zoom\",t),e.fire(\"change\",t)},this.onContextmenu=function(e){e.preventDefault(),e.stopPropagation()},this.map.container.addEventListener(\"mousedown\",this.onDown),this.map.container.addEventListener(\"mouseup\",this.onUp),this.map.container.addEventListener(\"mousemove\",this.onMove),this.map.container.addEventListener(\"wheel\",this.onWheel),this.map.container.addEventListener(\"contextmenu\",this.onContextmenu)}},{key:\"removeListenr\",value:function(){this.map.container.removeEventListener(\"mousedown\",this.onDown),this.map.container.removeEventListener(\"mouseup\",this.onUp),this.map.container.removeEventListener(\"mousemove\",this.onMove),this.map.container.removeEventListener(\"wheel\",this.onWheel),this.map.container.removeEventListener(\"contextmenu\",this.onContextmenu)}}]),t}(n(5).default);t.default=d},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(e){function t(e){var n;for(var i in a()(this,t),(n=c()(this,h()(t).call(this,e))).defaultParams={fontSize:\"14px\",color:\"#000000\",canvasRender:!1},n.texts=[],n.textId=0,n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(t,e),r()(t,[{key:\"onAdd\",value:function(e){this.pigeonMap=e,this.canvasRender?this.initCanvas():this.initDom();var t=this;function n(){t.updateText()}this.change=n,this.pigeonMap.on(\"change\",n)}},{key:\"initDom\",value:function(){this.container=this.pigeonMap.map.container;var e=document.createElement(\"div\");e.id=\"text_layer_\"+this.id,e.className=\"pigeonGL-text-layer\",e.setAttribute(\"width\",this.pigeonMap.map.width),e.setAttribute(\"height\",this.pigeonMap.map.height),e.style.position=\"absolute\",e.style.top=\"0\",e.style.left=\"0\",e.style.zIndex=++this.pigeonMap.zIndex,this.dom=e,this.container.appendChild(e)}},{key:\"initCanvas\",value:function(){this.container=this.pigeonMap.map.container;var e=document.createElement(\"canvas\");e.id=\"text_layer_\"+this.id,this.container.appendChild(e),e.setAttribute(\"width\",this.pigeonMap.map.width),e.setAttribute(\"height\",this.pigeonMap.map.height),e.style.position=\"absolute\",e.style.top=\"0\",e.style.left=\"0\",e.style.zIndex=++this.pigeonMap.zIndex,this.canvas=e}},{key:\"addText\",value:function(e){return(e=Object.assign({},e)).id=e.id||\"_text_\"+this.textId++,this.texts.push(e),e}},{key:\"drawText\",value:function(){this.canvasRender?this.drawCanvasText():this.drawDomText()}},{key:\"drawDomText\",value:function(){for(var e in this.dom.innerHTML=\"\",this.texts){var t=this.pigeonMap.projectToScreen(this.texts[e].lnglat),n=document.createElement(\"span\");for(var i in n.id=this.texts[e].id,n.innerHTML=this.texts[e].text,this.dom.appendChild(n),n.style.position=\"absolute\",n.style.top=t.y+\"px\",n.style.left=t.x+\"px\",this.texts[e].style)n.style[i]=this.texts[e].style[i]}}},{key:\"drawCanvasText\",value:function(){var e=this.canvas.getContext(\"2d\");for(var t in e.clearRect(0,0,this.canvas.width,this.canvas.height),this.texts){var n=this.pigeonMap.projectToScreen(this.texts[t].lnglat);e.font=this.texts[t].font||this.font,e.fillStyle=this.texts[t].color||this.color,e.fillText(this.texts[t].text,n.x,n.y)}}},{key:\"updateDomText\",value:function(){var e=this.dom.querySelectorAll(\"span\");for(var t in this.texts){var n=this.pigeonMap.projectToScreen(this.texts[t].lnglat);e[t].style.top=n.y+\"px\",e[t].style.left=n.x+\"px\"}}},{key:\"removeText\",value:function(e){for(var t in this.texts)if(this.texts[t].id==e)return this.texts.splice(t,1),void this.drawText()}},{key:\"update\",value:function(){}},{key:\"updateText\",value:function(){this.canvasRender?this.drawCanvasText():this.updateDomText()}},{key:\"getText\",value:function(e){for(var t in this.texts)if(this.texts[t].id==e)return this.text[t]}},{key:\"onRemove\",value:function(){this.pigeonMap.off(\"change\",this.change),this._listeners=null}},{key:\"getTextIndex\",value:function(e){for(var t in this.texts)if(this.texts[t].id==e)return t}}]),t}(n(5).default);t.default=d},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"default\",(function(){return d}));var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(e){function t(e){var n;return a()(this,t),(n=c()(this,h()(t).call(this,e))).noVR=!1,n.vrStatus=\"not suppert VR\",n.listenEvents(),n.getVRDisplays(),n}return p()(t,e),r()(t,[{key:\"getVRDisplays\",value:function(){var e=this;navigator.getVRDisplays&&navigator.getVRDisplays().then((function(t){t.length>0?(e.device=t[0],e.renderer.vr.enabled=!0,e.pigeonMap.renderer.vr.setDevice(e.device),e.frameData=new VRFrameData):(e.vrStatus=\"noDisplay\",console.warn(\"no vr displays\"))})).catch((function(e){console.warn(\"Unable to get VR Displays\")}))}},{key:\"listenEvents\",value:function(){var e=this;window.addEventListener(\"vrdisplayconnect\",(function(t){e.device=t.display||t.detail.display,e.status,e.renderer.vr.enabled=!0,e.fire(\"connected\",e.device)}),!1),window.addEventListener(\"vrdisplaydisconnect\",(function(t){e.status,e.renderer.vr.enabled=!1,e.fire(\"disconnet\",e.device)}),!1),window.addEventListener(\"vrdisplaypresentchange\",(function(t){e.device=t.display||t.detail.display,e.fire(\"statuschange\",e.device)}),!1)}},{key:\"enterVR\",value:function(){this.device.requestPresent([{source:this.renderer.domElement}])}},{key:\"exitVR\",value:function(){this.device.exitPresent()}},{key:\"createButton\",value:function(e){var t=this;e||((e=document.createElement(\"button\")).style.position=\"absolute\",e.style.bottom=\"20px\",e.style.padding=\"12px 6px\",e.style.border=\"1px solid #fff\",e.style.borderRadius=\"4px\",e.style.background=\"transparent\",e.style.color=\"#fff\",e.style.textAlign=\"center\",e.style.opacity=\"0.5\",e.style.outline=\"none\",e.style.zIndex=\"9999\",e.style.cursor=\"auto\",e.style.left=\"calc(50% - 75px)\",e.style.width=\"150px\",e.textContent=\"Enter VR\",document.body.appendChild(e)),e.addEventListener(\"click\",(function(){t.device&&t.enterVR()}))}},{key:\"onAdd\",value:function(e){this.pigeonMap=e,this.renderer=e.renderer,this.initVRRenderer()}},{key:\"initVRRenderer\",value:function(){}}]),t}(n(5).default)},function(e,t,n){\"use strict\";n.r(t);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(e){function t(e){var n;return a()(this,t),(n=c()(this,h()(t).call(this,e))).lanePoints=[],n.initPoints(),n}return p()(t,e),r()(t,[{key:\"initPoints\",value:function(){this.material=new THREE.PointsMaterial({color:16777215,size:10}),this.pointsGeometry=new THREE.BufferGeometry,this.points=new THREE.Points(this.pointsGeometry,this.material)}},{key:\"onAdd\",value:function(e){this.pigeonMap=e,this.pigeonMap.world.add(this.points)}},{key:\"drawPoints\",value:function(e){this.baseLngLat=e[0],this.baseXYZ=this.pigeonMap.projectToWorld(this.baseLngLat);var t,n=[],i=[],a=[];for(var o in e)t=this.pigeonMap.projectToWorld(e[o]),n.push(t.x-this.baseXYZ.x,t.y-this.baseXYZ.y,t.z-this.baseXYZ.z),a.push(e[o]),i.push(o);this.points.geometry.addAttribute(\"position\",new THREE.Float32BufferAttribute(n,3)),this.points.geometry.computeBoundingSphere(),this.points.position.x=this.baseXYZ.x,this.points.position.y=this.baseXYZ.y,this.points.position.z=this.baseXYZ.z}}]),t}(n(5).default);t.default=d},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"default\",(function(){return v}));var i=n(10),a=n.n(i),o=n(0),r=n.n(o),s=n(1),c=n.n(s),u=n(2),h=n.n(u),l=n(3),p=n.n(l),d=n(4),m=n.n(d),f=window.THREE,v=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"rgba(255, 255, 255, 1)\";return r()(this,t),(e=h()(this,p()(t).call(this,new f.SpriteMaterial({map:new f.Texture}))))._text=n,e._textHeight=i,e._color=a,e._fontFace=\"Arial\",e._fontSize=90,e._fontWeight=\"normal\",e._canvas=document.createElement(\"canvas\"),e._texture=e.material.map,e._texture.minFilter=f.LinearFilter,e._genCanvas(),e}return m()(t,e),c()(t,[{key:\"_genCanvas\",value:function(){var e=this,t=this._canvas,n=t.getContext(\"2d\"),i=this._text.split(\"\\n\");t.width=Math.max.apply(Math,a()(i.map((function(e){return n.measureText(e).width})))),t.height=this.fontSize*i.length,n.font=\"\".concat(this.fontWeight,\" \").concat(this.fontSize,\"px \").concat(this.fontFace),n.fillStyle=this.color,n.textBaseline=\"bottom\",i.forEach((function(i,a){return n.fillText(i,(t.width-n.measureText(i).width)/2,(a+1)*e.fontSize)})),this._texture.image=t,this._texture.needsUpdate=!0;var o=this.textHeight*i.length;this.scale.set(o*t.width/t.height,o)}},{key:\"clone\",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:\"copy\",value:function(e){return f.Sprite.prototype.copy.call(this,e),this.color=e.color,this.fontFace=e.fontFace,this.fontSize=e.fontSize,this.fontWeight=e.fontWeight,this}},{key:\"text\",get:function(){return this._text},set:function(e){this._text=e,this._genCanvas()}},{key:\"textHeight\",get:function(){return this._textHeight},set:function(e){this._textHeight=e,this._genCanvas()}},{key:\"color\",get:function(){return this._color},set:function(e){this._color=e,this._genCanvas()}},{key:\"fontFace\",get:function(){return this._fontFace},set:function(e){this._fontFace=e,this._genCanvas()}},{key:\"fontSize\",get:function(){return this._fontSize},set:function(e){this._fontSize=e,this._genCanvas()}},{key:\"fontWeight\",get:function(){return this._fontWeight},set:function(e){this._fontWeight=e,this._genCanvas()}}]),t}(f.Sprite)},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}}]).default}));","extractedComments":[]}