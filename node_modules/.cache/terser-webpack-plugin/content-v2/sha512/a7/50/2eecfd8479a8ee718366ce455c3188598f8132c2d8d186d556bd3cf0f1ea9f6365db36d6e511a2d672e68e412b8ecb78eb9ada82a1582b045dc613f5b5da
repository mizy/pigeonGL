{"code":"!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e(require(\"three\")):\"function\"==typeof define&&define.amd?define([\"three\"],e):\"object\"==typeof exports?exports.PigeonGL=e(require(\"three\")):t.PigeonGL=e(t.three)}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=11)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(6),a=n(16);t.exports=function(t,e){return!e||\"object\"!==i(e)&&\"function\"!=typeof e?a(t):e}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var i=n(17);t.exports=function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=function(){function t(e){a()(this,t),this.layers=[];for(var n in this._userConfig=e,e)this[n]=e[n]}return r()(t,[{key:\"on\",value:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}},{key:\"fire\",value:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n)for(var i=n.slice(0),a=0,o=i.length;a<o;a++)i[a].call(this,e)}}},{key:\"off\",value:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n)if(e){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}else this._listeners[t]=[]}}},{key:\"initConfig\",value:function(t){}},{key:\"onAdd\",value:function(t){this.pigeonMap=t}},{key:\"update\",value:function(){}},{key:\"onRemove\",value:function(){this._listeners&&(this._listeners=[])}},{key:\"addLayer\",value:function(t){t.id=++this._layerid,this.layers.push(t),t.onAdd(this)}},{key:\"removeLayer\",value:function(t){for(var e in this.layers)if(this.layers[e].id==t.id)return this.layers[e].onRemove(),void this.layers.splice(e,1)}},{key:\"getLayerById\",value:function(t){for(var e=0;e<this.layers.length;e++)if(this.layer.id===t)return layer}}]),t}();e.default=s},function(t,e){function n(t){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function i(e){return\"function\"==typeof Symbol&&\"symbol\"===n(Symbol.iterator)?t.exports=i=function(t){return n(t)}:t.exports=i=function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":n(t)},i(e)}t.exports=i},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=(n(8),n(18)),c=function(){function t(e){a()(this,t),this.scope=e,this.map=e.map,this.camera=e.camera,this.active=!0,this.world=e.world||new THREE.Group,this.world.position.x=this.world.position.y=0,this.camera.matrixAutoUpdate=!1,this.update()}return r()(t,[{key:\"update\",value:function(t){this.map=Object.assign(this.map,t),this.initMapTransform(),this.updateCamera()}},{key:\"listenMapChange\",value:function(){this.update(this.map)}},{key:\"initMapTransform\",value:function(){var t={};t.width=this.map.width,t.height=this.map.height,t.zHeight=this.map.zHeight||0,t.x=this.map.center[0],t.y=this.map.center[1],t.z=this.map.center[2]||this.getZ(this.map.zoom),t._pitch=this.map.pitch*Math.PI/180||0,t.angle=this.map.rotation*Math.PI/180||0,this.map.transform=t}},{key:\"getZ\",value:function(t){return t}},{key:\"setCenter\",value:function(t){this.map.center=t,this.initMapTransform()}},{key:\"setRotation\",value:function(t){this.map.rotation=t,this.map.transform.angle=this.map.rotation*Math.PI/180}},{key:\"setPitch\",value:function(t){this.map.pitch=t,this.map.transform._pitch=this.map.pitch*Math.PI/180}},{key:\"updateCamera\",value:function(t){var e=Math.abs(this.map.transform.z)+this.map.transform.zHeight,n=this.map.fov||.6435011087932844,i=e,a=n/2,o=Math.PI/2+this.map.transform._pitch,r=Math.sin(a)*i/Math.sin(Math.PI-o-a),c=1.01*(Math.cos(Math.PI/2-this.map.transform._pitch)*r+i);this.camera.projectionMatrix=s.makePerspectiveMatrix(n,this.map.transform.width/this.map.transform.height,1,c);var u=new THREE.Matrix4,h=(new THREE.Matrix4).makeTranslation(0,0,e),l=(new THREE.Matrix4).makeRotationX(this.map.transform._pitch),p=(new THREE.Matrix4).makeRotationZ(this.map.transform.angle);u.premultiply(h).premultiply(l).premultiply(p),this.camera.matrixWorld.copy(u),this.world.position.x=-this.map.transform.x,this.world.position.y=-this.map.transform.y}}]),t}();e.default=c},function(t,e){var n=512*Math.pow(2,0);t.exports={WORLD_SIZE_RATIO:0,WORLD_SIZE:n,PROJECTION_WORLD_SIZE:n/(6378137*Math.PI)/2,MERCATOR_A:6378137,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_CIRCUMFERENCE:40075e3,DISTANCE:200}},function(e,n){e.exports=t},function(t,e,n){var i=n(25),a=n(26),o=n(27);t.exports=function(t){return i(t)||a(t)||o()}},function(t,e,n){\"use strict\";n.r(e);var i=n(9);window.THREE=i;var a={OrbitControls:n(12),MTLLoader:n(13),OBJLoader:n(14),Map:n(15).default,Layer:n(5).default,CameraControl:n(7).default,ThirdPersonView:n(19).default,MapControl:n(20).default,TextLayer:n(21).default,VRLayer:n(22).default,CloudPoints:n(23).default,Text:n(24).default};window.PigeonGL=a,e.default=a},function(t,e){THREE.OrbitControls=function(t,e){var n,i,a,o,r;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),p=l.NONE},this.update=(n=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),a=i.clone().inverse(),o=new THREE.Vector3,r=new THREE.Quaternion,function(){var t=s.object.position;return n.copy(t).sub(s.target),n.applyQuaternion(i),m.setFromVector3(n),s.autoRotate&&p===l.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),m.theta+=f.theta,m.phi+=f.phi,m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=v,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),s.target.add(g),n.setFromSpherical(m),n.applyQuaternion(a),t.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(f.theta*=1-s.dampingFactor,f.phi*=1-s.dampingFactor):f.set(0,0,0),v=1,g.set(0,0,0),!!(y||o.distanceToSquared(s.object.position)>d||8*(1-r.dot(s.object.quaternion))>d)&&(s.dispatchEvent(c),o.copy(s.object.position),r.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener(\"contextmenu\",W,!1),s.domElement.removeEventListener(\"mousedown\",z,!1),s.domElement.removeEventListener(\"wheel\",F,!1),s.domElement.removeEventListener(\"touchstart\",N,!1),s.domElement.removeEventListener(\"touchend\",G,!1),s.domElement.removeEventListener(\"touchmove\",Z,!1),document.removeEventListener(\"mousemove\",D,!1),document.removeEventListener(\"mouseup\",V,!1),window.removeEventListener(\"keydown\",U,!1)};var s=this,c={type:\"change\"},u={type:\"start\"},h={type:\"end\"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},p=l.NONE,d=1e-6,m=new THREE.Spherical,f=new THREE.Spherical,v=1,g=new THREE.Vector3,y=!1,E=new THREE.Vector2,b=new THREE.Vector2,x=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,M=new THREE.Vector2,k=new THREE.Vector2,_=new THREE.Vector2;function O(){return Math.pow(.95,s.zoomSpeed)}function P(t){f.theta-=t}function H(t){f.phi-=t}var j,C=(j=new THREE.Vector3,function(t,e){j.setFromMatrixColumn(e,0),j.multiplyScalar(-t),g.add(j)}),L=function(){var t=new THREE.Vector3;return function(e,n){t.setFromMatrixColumn(n,1),t.multiplyScalar(e),g.add(t)}}(),S=function(){var t=new THREE.Vector3;return function(e,n){var i=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var a=s.object.position;t.copy(a).sub(s.target);var o=t.length();o*=Math.tan(s.object.fov/2*Math.PI/180),C(2*e*o/i.clientHeight,s.object.matrix),L(2*n*o/i.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(C(e*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),L(n*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.\"),s.enablePan=!1)}}();function A(t){s.object.isPerspectiveCamera?v/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),y=!0):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\"),s.enableZoom=!1)}function I(t){s.object.isPerspectiveCamera?v*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),y=!0):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\"),s.enableZoom=!1)}function z(t){if(!1!==s.enabled){switch(t.preventDefault(),t.button){case s.mouseButtons.ORBIT:if(!1===s.enableRotate)return;!function(t){E.set(t.clientX,t.clientY)}(t),p=l.ROTATE;break;case s.mouseButtons.ZOOM:if(!1===s.enableZoom)return;!function(t){M.set(t.clientX,t.clientY)}(t),p=l.DOLLY;break;case s.mouseButtons.PAN:if(!1===s.enablePan)return;!function(t){w.set(t.clientX,t.clientY)}(t),p=l.PAN}p!==l.NONE&&(document.addEventListener(\"mousemove\",D,!1),document.addEventListener(\"mouseup\",V,!1),s.dispatchEvent(u))}}function D(t){if(!1!==s.enabled)switch(t.preventDefault(),p){case l.ROTATE:if(!1===s.enableRotate)return;!function(t){b.set(t.clientX,t.clientY),x.subVectors(b,E);var e=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*x.x/e.clientWidth*s.rotateSpeed),H(2*Math.PI*x.y/e.clientHeight*s.rotateSpeed),E.copy(b),s.update()}(t);break;case l.DOLLY:if(!1===s.enableZoom)return;!function(t){k.set(t.clientX,t.clientY),_.subVectors(k,M),_.y>0?A(O()):_.y<0&&I(O()),M.copy(k),s.update()}(t);break;case l.PAN:if(!1===s.enablePan)return;!function(t){T.set(t.clientX,t.clientY),R.subVectors(T,w),S(R.x,R.y),w.copy(T),s.update()}(t)}}function V(t){!1!==s.enabled&&(document.removeEventListener(\"mousemove\",D,!1),document.removeEventListener(\"mouseup\",V,!1),s.dispatchEvent(h),p=l.NONE)}function F(t){!1===s.enabled||!1===s.enableZoom||p!==l.NONE&&p!==l.ROTATE||(t.preventDefault(),t.stopPropagation(),s.dispatchEvent(u),function(t){t.deltaY<0?I(O()):t.deltaY>0&&A(O()),s.update()}(t),s.dispatchEvent(h))}function U(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){switch(t.keyCode){case s.keys.UP:S(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:S(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:S(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:S(-s.keyPanSpeed,0),s.update()}}(t)}function N(t){if(!1!==s.enabled){switch(t.touches.length){case 1:if(!1===s.enableRotate)return;!function(t){E.set(t.touches[0].pageX,t.touches[0].pageY)}(t),p=l.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);M.set(0,i)}(t),p=l.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;!function(t){w.set(t.touches[0].pageX,t.touches[0].pageY)}(t),p=l.TOUCH_PAN;break;default:p=l.NONE}p!==l.NONE&&s.dispatchEvent(u)}}function Z(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===s.enableRotate)return;if(p!==l.TOUCH_ROTATE)return;!function(t){b.set(t.touches[0].pageX,t.touches[0].pageY),x.subVectors(b,E);var e=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*x.x/e.clientWidth*s.rotateSpeed),H(2*Math.PI*x.y/e.clientHeight*s.rotateSpeed),E.copy(b),s.update()}(t);break;case 2:if(!1===s.enableZoom)return;if(p!==l.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);k.set(0,i),_.subVectors(k,M),_.y>0?I(O()):_.y<0&&A(O()),M.copy(k),s.update()}(t);break;case 3:if(!1===s.enablePan)return;if(p!==l.TOUCH_PAN)return;!function(t){T.set(t.touches[0].pageX,t.touches[0].pageY),R.subVectors(T,w),S(R.x,R.y),w.copy(T),s.update()}(t);break;default:p=l.NONE}}function G(t){!1!==s.enabled&&(s.dispatchEvent(h),p=l.NONE)}function W(t){!1!==s.enabled&&t.preventDefault()}s.domElement.addEventListener(\"contextmenu\",W,!1),s.domElement.addEventListener(\"mousedown\",z,!1),s.domElement.addEventListener(\"wheel\",F,!1),s.domElement.addEventListener(\"touchstart\",N,!1),s.domElement.addEventListener(\"touchend\",G,!1),s.domElement.addEventListener(\"touchmove\",Z,!1),window.addEventListener(\"keydown\",U,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn(\"THREE.OrbitControls: .center has been renamed to .target\"),this.target}},noZoom:{get:function(){return console.warn(\"THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.\"),!this.enableZoom},set:function(t){console.warn(\"THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.\"),this.enableZoom=!t}},noRotate:{get:function(){return console.warn(\"THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.\"),!this.enableRotate},set:function(t){console.warn(\"THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.\"),this.enableRotate=!t}},noPan:{get:function(){return console.warn(\"THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.\"),!this.enablePan},set:function(t){console.warn(\"THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.\"),this.enablePan=!t}},noKeys:{get:function(){return console.warn(\"THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.\"),!this.enableKeys},set:function(t){console.warn(\"THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.\"),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn(\"THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.\"),!this.enableDamping},set:function(t){console.warn(\"THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.\"),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn(\"THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.\"),this.dampingFactor},set:function(t){console.warn(\"THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.\"),this.dampingFactor=t}}})},function(t,e){var n=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager};n.prototype={constructor:n,load:function(t,e,n,i){var a=this,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.load(t,(function(t){e(a.parse(t))}),n,i)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn(\"THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.\"),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split(\"\\n\"),i={},a=/\\s+/,o={},r=0;r<e.length;r++){var s=e[r];if(0!==(s=s.trim()).length&&\"#\"!==s.charAt(0)){var c=s.indexOf(\" \"),u=c>=0?s.substring(0,c):s;u=u.toLowerCase();var h=c>=0?s.substring(c+1):\"\";if(h=h.trim(),\"newmtl\"===u)i={name:h},o[h]=i;else if(i)if(\"ka\"===u||\"kd\"===u||\"ks\"===u){var l=h.split(a,3);i[u]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else i[u]=h}}var p=new n.MaterialCreator(this.texturePath||this.path,this.materialOptions);return p.setCrossOrigin(this.crossOrigin),p.setManager(this.manager),p.setMaterials(o),p}},(n.MaterialCreator=function(t,e){this.baseUrl=t||\"\",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping}).prototype={constructor:n.MaterialCreator,setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var i=t[n],a={};for(var o in e[n]=a,i){var r=!0,s=i[o],c=o.toLowerCase();switch(c){case\"kd\":case\"ka\":case\"ks\":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(r=!1)}r&&(a[c]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,n=this.materialsInfo[t],i={name:t,side:this.side};function a(t,n){if(!i[t]){var a,o,r=e.getTextureParams(n,i),s=e.loadTexture((a=e.baseUrl,\"string\"!=typeof(o=r.url)||\"\"===o?\"\":/^https?:\\/\\//i.test(o)?o:a+o));s.repeat.copy(r.scale),s.offset.copy(r.offset),s.wrapS=e.wrap,s.wrapT=e.wrap,i[t]=s}}for(var o in n){var r=n[o];if(\"\"!==r)switch(o.toLowerCase()){case\"kd\":i.color=(new THREE.Color).fromArray(r);break;case\"ks\":i.specular=(new THREE.Color).fromArray(r);break;case\"map_kd\":a(\"map\",r);break;case\"map_ks\":a(\"specularMap\",r);break;case\"map_bump\":case\"bump\":a(\"bumpMap\",r);break;case\"ns\":i.shininess=parseFloat(r);break;case\"d\":r<1&&(i.opacity=r,i.transparent=!0);break;case\"Tr\":r>0&&(i.opacity=1-r,i.transparent=!0)}}return this.materials[t]=new THREE.MeshPhongMaterial(i),this.materials[t]},getTextureParams:function(t,e){var n,i={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},a=t.split(/\\s+/);return(n=a.indexOf(\"-bm\"))>=0&&(e.bumpScale=parseFloat(a[n+1]),a.splice(n,2)),(n=a.indexOf(\"-s\"))>=0&&(i.scale.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),(n=a.indexOf(\"-o\"))>=0&&(i.offset.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),i.url=a.join(\" \").trim(),i},loadTexture:function(t,e,n,i,a){var o,r=THREE.Loader.Handlers.get(t),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===r&&(r=new THREE.TextureLoader(s)),r.setCrossOrigin&&r.setCrossOrigin(this.crossOrigin),o=r.load(t,n,i,a),void 0!==e&&(o.mapping=e),o}},t.exports=n},function(t,e){var n=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,normal_pattern:/^vn\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,uv_pattern:/^vt\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,face_vertex:/^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,face_vertex_uv:/^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,face_vertex_uv_normal:/^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,face_vertex_normal:/^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,object_pattern:/^[og]\\s*(.+)?/,smoothing_pattern:/^s\\s+(\\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};n.prototype={constructor:n,load:function(t,e,n,i){var a=this,o=new THREE.FileLoader(a.manager);o.setPath(this.path),o.load(t,(function(t){e(a.parse(t))}),n,i)},setPath:function(t){this.path=t},setMaterials:function(t){this.materials=t},_createParserState:function(){var t={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var n=this.object&&\"function\"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&\"function\"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||\"\",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:t||\"\",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:\"\",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:\"number\"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:\"\",smooth:this.smooth}),e}},n&&n.name&&\"function\"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&\"function\"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var i=this.vertices,a=this.object.geometry.vertices;a.push(i[t+0]),a.push(i[t+1]),a.push(i[t+2]),a.push(i[e+0]),a.push(i[e+1]),a.push(i[e+2]),a.push(i[n+0]),a.push(i[n+1]),a.push(i[n+2])},addVertexLine:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0]),n.push(e[t+1]),n.push(e[t+2])},addNormal:function(t,e,n){var i=this.normals,a=this.object.geometry.normals;a.push(i[t+0]),a.push(i[t+1]),a.push(i[t+2]),a.push(i[e+0]),a.push(i[e+1]),a.push(i[e+2]),a.push(i[n+0]),a.push(i[n+1]),a.push(i[n+2])},addUV:function(t,e,n){var i=this.uvs,a=this.object.geometry.uvs;a.push(i[t+0]),a.push(i[t+1]),a.push(i[e+0]),a.push(i[e+1]),a.push(i[n+0]),a.push(i[n+1])},addUVLine:function(t){var e=this.uvs,n=this.object.geometry.uvs;n.push(e[t+0]),n.push(e[t+1])},addFace:function(t,e,n,i,a,o,r,s,c,u,h,l){var p,d=this.vertices.length,m=this.parseVertexIndex(t,d),f=this.parseVertexIndex(e,d),v=this.parseVertexIndex(n,d);if(void 0===i?this.addVertex(m,f,v):(p=this.parseVertexIndex(i,d),this.addVertex(m,f,p),this.addVertex(f,v,p)),void 0!==a){var g=this.uvs.length;m=this.parseUVIndex(a,g),f=this.parseUVIndex(o,g),v=this.parseUVIndex(r,g),void 0===i?this.addUV(m,f,v):(p=this.parseUVIndex(s,g),this.addUV(m,f,p),this.addUV(f,v,p))}if(void 0!==c){var y=this.normals.length;m=this.parseNormalIndex(c,y),f=c===u?m:this.parseNormalIndex(u,y),v=c===h?m:this.parseNormalIndex(h,y),void 0===i?this.addNormal(m,f,v):(p=this.parseNormalIndex(l,y),this.addNormal(m,f,p),this.addNormal(f,v,p))}},addLineGeometry:function(t,e){this.object.geometry.type=\"Line\";for(var n=this.vertices.length,i=this.uvs.length,a=0,o=t.length;a<o;a++)this.addVertexLine(this.parseVertexIndex(t[a],n));var r=0;for(o=e.length;r<o;r++)this.addUVLine(this.parseUVIndex(e[r],i))}};return t.startObject(\"\",!1),t},parse:function(t){var e=this._createParserState();-1!==t.indexOf(\"\\r\\n\")&&(t=t.replace(/\\r\\n/g,\"\\n\")),-1!==t.indexOf(\"\\\\\\n\")&&(t=t.replace(/\\\\\\n/g,\"\"));for(var n=t.split(\"\\n\"),i=\"\",a=\"\",o=\"\",r=[],s=\"function\"==typeof\"\".trimLeft,c=0,u=n.length;c<u;c++)if(i=n[c],0!==(i=s?i.trimLeft():i.trim()).length&&\"#\"!==(a=i.charAt(0)))if(\"v\"===a)if(\" \"===(o=i.charAt(1))&&null!==(r=this.regexp.vertex_pattern.exec(i)))e.vertices.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));else if(\"n\"===o&&null!==(r=this.regexp.normal_pattern.exec(i)))e.normals.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));else{if(\"t\"!==o||null===(r=this.regexp.uv_pattern.exec(i)))throw new Error(\"Unexpected vertex/normal/uv line: '\"+i+\"'\");e.uvs.push(parseFloat(r[1]),parseFloat(r[2]))}else if(\"f\"===a)if(null!==(r=this.regexp.face_vertex_uv_normal.exec(i)))e.addFace(r[1],r[4],r[7],r[10],r[2],r[5],r[8],r[11],r[3],r[6],r[9],r[12]);else if(null!==(r=this.regexp.face_vertex_uv.exec(i)))e.addFace(r[1],r[3],r[5],r[7],r[2],r[4],r[6],r[8]);else if(null!==(r=this.regexp.face_vertex_normal.exec(i)))e.addFace(r[1],r[3],r[5],r[7],void 0,void 0,void 0,void 0,r[2],r[4],r[6],r[8]);else{if(null===(r=this.regexp.face_vertex.exec(i)))throw new Error(\"Unexpected face line: '\"+i+\"'\");e.addFace(r[1],r[2],r[3],r[4])}else if(\"l\"===a){var h=i.substring(1).trim().split(\" \"),l=[],p=[];if(-1===i.indexOf(\"/\"))l=h;else for(var d=0,m=h.length;d<m;d++){var f=h[d].split(\"/\");\"\"!==f[0]&&l.push(f[0]),\"\"!==f[1]&&p.push(f[1])}e.addLineGeometry(l,p)}else if(null!==(r=this.regexp.object_pattern.exec(i))){var v=(\" \"+r[0].substr(1).trim()).substr(1);e.startObject(v)}else if(this.regexp.material_use_pattern.test(i))e.object.startMaterial(i.substring(7).trim(),e.materialLibraries);else if(this.regexp.material_library_pattern.test(i))e.materialLibraries.push(i.substring(7).trim());else{if(null===(r=this.regexp.smoothing_pattern.exec(i))){if(\"\\0\"===i)continue;throw new Error(\"Unexpected line: '\"+i+\"'\")}var g=r[1].trim().toLowerCase();e.object.smooth=\"1\"===g||\"on\"===g,(P=e.object.currentMaterial())&&(P.smooth=e.object.smooth)}e.finalize();var y=new THREE.Group;y.materialLibraries=[].concat(e.materialLibraries);for(c=0,u=e.objects.length;c<u;c++){var E=e.objects[c],b=E.geometry,x=E.materials,w=\"Line\"===b.type;if(0!==b.vertices.length){var T=new THREE.BufferGeometry;T.addAttribute(\"position\",new THREE.BufferAttribute(new Float32Array(b.vertices),3)),b.normals.length>0?T.addAttribute(\"normal\",new THREE.BufferAttribute(new Float32Array(b.normals),3)):T.computeVertexNormals(),b.uvs.length>0&&T.addAttribute(\"uv\",new THREE.BufferAttribute(new Float32Array(b.uvs),2));for(var R,M=[],k=0,_=x.length;k<_;k++){var O=x[k],P=void 0;if(null!==this.materials&&(P=this.materials.create(O.name),w&&P&&!(P instanceof THREE.LineBasicMaterial))){var H=new THREE.LineBasicMaterial;H.copy(P),H.lights=!1,P=H}P||((P=w?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=O.name),P.flatShading=O.smooth?THREE.SmoothShading:THREE.FlatShading,M.push(P)}if(M.length>1){for(k=0,_=x.length;k<_;k++){O=x[k];T.addGroup(O.groupStart,O.groupCount,k)}var j=new THREE.MultiMaterial(M);R=w?new THREE.LineSegments(T,j):new THREE.Mesh(T,j)}else R=w?new THREE.LineSegments(T,M[0]):new THREE.Mesh(T,M[0]);R.name=E.name,y.add(R)}}return y}},t.exports=n},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=n(7),m=n(5),f=n(8),v=function(t){function e(t){var n;return a()(this,e),(n=c()(this,h()(e).call(this)))._layerid=0,n.zIndex=1e3,n.status=\"running\",n.type=\"gps\",n.layers=[],n.clock=new THREE.Clock,n.clock.start(),n.initMap(t),n.initWorld(),n.map.hasGround&&n.addGround(),n.update(),n}return p()(e,t),r()(e,[{key:\"initMap\",value:function(t){this.map=Object.assign({rotation:0,width:1e3,height:600,pitch:45,zoom:21,center:[0,0]},t)}},{key:\"initWorld\",value:function(){this.renderer=new THREE.WebGLRenderer(Object.assign({alpha:!0,antialias:!0},this.map.rendererOptions)),this.renderer.setSize(this.map.width,this.map.height),this.map.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position=\"relative\",this.renderer.domElement.style[\"pointer-events\"]=\"none\",this.renderer.domElement.style[\"z-index\"]=++this.zIndex,this.scene=new THREE.Scene(Object.assign({},this.map.sceneOptions||{})),this.camera=new THREE.PerspectiveCamera(45,this.map.width/this.map.height,1e-6,5e9),this.layers=[],this.world=new THREE.Group,this.scene.add(this.world),this.camera.position.z=10,this.camera.position.x=this.map.center[0],this.camera.position.y=this.map.center[1],this.cameraControl=new d.default(this)}},{key:\"moveTo\",value:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.preScale;return t.userData.isGeoGroup?n=t:t.parent&&t.parent.userData.isGeoGroup&&(n=t.parent),n.scale.copy(a||1),n.position.copy(this.projectToWorld(e)),t.coordinates=e,t}},{key:\"update\",value:function(){var t,e=this,n=this.clock.getDelta();for(var i in this.layers)this.layers[i].update&&this.layers[i].update(n);this.renderer.render(this.scene,this.camera),(t=this.renderer.vr.getDevice())?this.animationframe=t.requestAnimationFrame((function(t){\"stop\"!=e.status&&e.update(n,t)})):this.animationframe=requestAnimationFrame((function(t){\"stop\"!=e.status&&e.update(n,t)}))}},{key:\"projectToWorld\",value:function(t){return{x:t[0],y:t[1],z:t[2]||0}}},{key:\"unprojectFromWorld\",value:function(t){return[t.x,t.y,t.z]}},{key:\"projectToScreen\",value:function(t){var e=Object.assign({},t);e[1]=-e[1];var n=this.projectToWorld(e),i=this.world.getWorldPosition().clone().add(n).project(this.camera),a=this.map.width/2,o=this.map.height/2;return{x:Math.round(i.x*a+a),y:this.map.height-Math.round(i.y*o+o)}}},{key:\"unprojectFromScreen\",value:function(t){var e=this.map.width/2,n=this.map.height/2,i=-(t.x-e)/e,a=(this.map.height-t.y-n)/n,o=new THREE.Vector3(i,a,0).unproject(this.camera),r=this.world.getWorldPosition().clone(),s=this.unprojectFromWorld(o.sub(r));return s[1]=-s[1],s}},{key:\"add\",value:function(t,e,n){var i=new THREE.Group;return i.userData.isGeoGroup=!0,i.add(t),this.world.add(i),this.moveTo(t,e,n),t}},{key:\"addGround\",value:function(){var t=new THREE.PlaneGeometry(f.WORLD_SIZE,f.WORLD_SIZE),e=new THREE.MeshPhongMaterial({color:this.map.groundColor||6710886,shininess:30}),n=new THREE.Mesh(t,e);n.position.z=-.01,this.add(n,this.map.center,{scaleToLatitude:!0,preScale:100})}},{key:\"remove\",value:function(t){this.world.remove(t)}},{key:\"setupDefaultLights\",value:function(){this.scene.add(new THREE.AmbientLight(13421772));var t=new THREE.DirectionalLight(16777215,.5);t.position.set(0,800,1e3),t.matrixWorldNeedsUpdate=!0,this.world.add(t)}}]),e}(m.default);e.default=v},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e,n){\"use strict\";n.r(e),n.d(e,\"prettyPrintMatrix\",(function(){return o})),n.d(e,\"makePerspectiveMatrix\",(function(){return r})),n.d(e,\"radify\",(function(){return s})),n.d(e,\"degreeify\",(function(){return c}));var i=n(6),a=n.n(i);function o(t){for(var e=0;e<4;e++)t[e],t[e+4],t[e+8],t[e+12]}function r(t,e,n,i){var a=new THREE.Matrix4,o=1/Math.tan(t/2),r=1/(n-i);return a.elements[0]=o/e,a.elements[1]=0,a.elements[2]=0,a.elements[3]=0,a.elements[4]=0,a.elements[5]=o,a.elements[6]=0,a.elements[7]=0,a.elements[8]=0,a.elements[9]=0,a.elements[10]=(i+n)*r,a.elements[11]=-1,a.elements[12]=0,a.elements[13]=0,a.elements[14]=2*i*n*r,a.elements[15]=0,a}function s(t){return\"object\"===a()(t)?t.map((function(t){return 2*Math.PI*t/360})):2*Math.PI*t/360}function c(t){return 360*t/(2*Math.PI)}},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(t){function e(t){var n;for(var i in a()(this,e),(n=c()(this,h()(e).call(this,t))).defaultParams={target:null,viewRotation:0,targetRotation:0,autoUpdate:!1,lockRotation:!0},n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(e,t),r()(e,[{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.initCamera()}},{key:\"initCamera\",value:function(){}},{key:\"update\",value:function(){this.autoUpdate&&this.updateCamera()}},{key:\"updateCamera\",value:function(t){if(!this.target)return!1;var e=this.target.coordinates;this.lockRotation&&(t||(t=180*this.target.rotation.z/Math.PI+this.targetRotation+this.viewRotation),this.pigeonMap.cameraControl.setRotation(t)),this.pigeonMap.cameraControl.setCenter(e),this.pigeonMap.cameraControl.updateCamera()}}]),e}(n(5).default);e.default=d},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(t){function e(t){var n;for(var i in a()(this,e),(n=c()(this,h()(e).call(this,t))).defaultParams={zoomBase:600,moveSpeed:1,pitchSpeed:.1,rotateSpeed:.15},n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(e,t),r()(e,[{key:\"onAdd\",value:function(t){var e=this;this.pigeonMap=t,this.map=this.pigeonMap.map,this.cameraControl=this.pigeonMap.cameraControl,this.initConfig(),this.listenEvents(),this.on(\"change\",(function(){e.pigeonMap.fire(\"change\"),e.cameraControl.update()}))}},{key:\"initConfig\",value:function(){}},{key:\"listenEvents\",value:function(){var t=this;this.onDown=function(e){0==e.button?t.mouseStatus=\"left\":2==e.button&&(t.mouseStatus=\"right\"),t.mouseDownPosition={x:e.clientX,y:e.clientY},t.map.container.addEventListener(\"mousemove\",t.onMove)},this.onUp=function(e){t.mouseStatus=!1,t.map.container.removeEventListener(\"mousemove\",t.onMove)},this.onMove=function(e){if(t.mouseStatus){if(\"left\"==t.mouseStatus){var n=e.clientY-t.mouseDownPosition.y,i=e.clientX-t.mouseDownPosition.x,a=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));if(a<.1)return!1;var o=(i>0?-1:1)*Math.asin(n/a)+t.map.transform.angle,r=t.moveSpeed*(t.map.zoom/(t.zoomBase+Math.pow(t.map.zoom,2)));t.map.center[0]+=(i>0?-1:1)*(a*Math.cos(o))*r,t.map.center[1]+=(i>0?-1:1)*(a*Math.sin(o))*r,t.cameraControl.update(),t.fire(\"move\",e),t.fire(\"change\",e)}else\"right\"==t.mouseStatus&&(t.map.pitch+=t.pitchSpeed*(e.clientY-t.mouseDownPosition.y),t.map.pitch>90?t.map.pitch=90:t.map.pitch<0&&(t.map.pitch=0),t.map.rotation-=t.rotateSpeed*(e.clientX-t.mouseDownPosition.x),t.cameraControl.update(),t.fire(\"rotate\",e),t.fire(\"change\",e));t.mouseDownPosition={x:e.clientX,y:e.clientY}}},this.onWheel=function(e){if(t.map.zoom-=e.deltaY*t.map.zoom/t.zoomBase,t.map.zoom<5)return t.map.zoom=5;t.cameraControl.update(),e.preventDefault(),t.fire(\"zoom\",e),t.fire(\"change\",e)},this.onContextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.map.container.addEventListener(\"mousedown\",this.onDown),this.map.container.addEventListener(\"mouseup\",this.onUp),this.map.container.addEventListener(\"mousemove\",this.onMove),this.map.container.addEventListener(\"wheel\",this.onWheel),this.map.container.addEventListener(\"contextmenu\",this.onContextmenu)}},{key:\"removeListenr\",value:function(){this.map.container.removeEventListener(\"mousedown\",this.onDown),this.map.container.removeEventListener(\"mouseup\",this.onUp),this.map.container.removeEventListener(\"mousemove\",this.onMove),this.map.container.removeEventListener(\"wheel\",this.onWheel),this.map.container.removeEventListener(\"contextmenu\",this.onContextmenu)}}]),e}(n(5).default);e.default=d},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(t){function e(t){var n;for(var i in a()(this,e),(n=c()(this,h()(e).call(this,t))).defaultParams={fontSize:\"14px\",color:\"#000000\",canvasRender:!1},n.texts=[],n.textId=0,n.defaultParams)void 0===n[i]&&(n[i]=n.defaultParams[i]);return n}return p()(e,t),r()(e,[{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.canvasRender?this.initCanvas():this.initDom();var e=this;function n(){e.updateText()}this.change=n,this.pigeonMap.on(\"change\",n)}},{key:\"initDom\",value:function(){this.container=this.pigeonMap.map.container;var t=document.createElement(\"div\");t.id=\"text_layer_\"+this.id,t.className=\"pigeonGL-text-layer\",t.setAttribute(\"width\",this.pigeonMap.map.width),t.setAttribute(\"height\",this.pigeonMap.map.height),t.style.position=\"absolute\",t.style.top=\"0\",t.style.left=\"0\",t.style.zIndex=++this.pigeonMap.zIndex,this.dom=t,this.container.appendChild(t)}},{key:\"initCanvas\",value:function(){this.container=this.pigeonMap.map.container;var t=document.createElement(\"canvas\");t.id=\"text_layer_\"+this.id,this.container.appendChild(t),t.setAttribute(\"width\",this.pigeonMap.map.width),t.setAttribute(\"height\",this.pigeonMap.map.height),t.style.position=\"absolute\",t.style.top=\"0\",t.style.left=\"0\",t.style.zIndex=++this.pigeonMap.zIndex,this.canvas=t}},{key:\"addText\",value:function(t){return(t=Object.assign({},t)).id=t.id||\"_text_\"+this.textId++,this.texts.push(t),t}},{key:\"drawText\",value:function(){this.canvasRender?this.drawCanvasText():this.drawDomText()}},{key:\"drawDomText\",value:function(){for(var t in this.dom.innerHTML=\"\",this.texts){var e=this.pigeonMap.projectToScreen(this.texts[t].lnglat),n=document.createElement(\"span\");for(var i in n.id=this.texts[t].id,n.innerHTML=this.texts[t].text,this.dom.appendChild(n),n.style.position=\"absolute\",n.style.top=e.y+\"px\",n.style.left=e.x+\"px\",this.texts[t].style)n.style[i]=this.texts[t].style[i]}}},{key:\"drawCanvasText\",value:function(){var t=this.canvas.getContext(\"2d\");for(var e in t.clearRect(0,0,this.canvas.width,this.canvas.height),this.texts){var n=this.pigeonMap.projectToScreen(this.texts[e].lnglat);t.font=this.texts[e].font||this.font,t.fillStyle=this.texts[e].color||this.color,t.fillText(this.texts[e].text,n.x,n.y)}}},{key:\"updateDomText\",value:function(){var t=this.dom.querySelectorAll(\"span\");for(var e in this.texts){var n=this.pigeonMap.projectToScreen(this.texts[e].lnglat);t[e].style.top=n.y+\"px\",t[e].style.left=n.x+\"px\"}}},{key:\"removeText\",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return this.texts.splice(e,1),void this.drawText()}},{key:\"update\",value:function(){}},{key:\"updateText\",value:function(){this.canvasRender?this.drawCanvasText():this.updateDomText()}},{key:\"getText\",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return this.text[e]}},{key:\"onRemove\",value:function(){this.pigeonMap.off(\"change\",this.change),this._listeners=null}},{key:\"getTextIndex\",value:function(t){for(var e in this.texts)if(this.texts[e].id==t)return e}}]),e}(n(5).default);e.default=d},function(t,e,n){\"use strict\";n.r(e),n.d(e,\"default\",(function(){return d}));var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(t){function e(t){var n;return a()(this,e),(n=c()(this,h()(e).call(this,t))).noVR=!1,n.vrStatus=\"not suppert VR\",n.listenEvents(),n.getVRDisplays(),n}return p()(e,t),r()(e,[{key:\"getVRDisplays\",value:function(){var t=this;navigator.getVRDisplays&&navigator.getVRDisplays().then((function(e){e.length>0?(t.device=e[0],t.renderer.vr.enabled=!0,t.pigeonMap.renderer.vr.setDevice(t.device),t.frameData=new VRFrameData):(t.vrStatus=\"noDisplay\",console.warn(\"no vr displays\"))})).catch((function(t){console.warn(\"Unable to get VR Displays\")}))}},{key:\"listenEvents\",value:function(){var t=this;window.addEventListener(\"vrdisplayconnect\",(function(e){t.device=e.display||e.detail.display,t.status,t.renderer.vr.enabled=!0,t.fire(\"connected\",t.device)}),!1),window.addEventListener(\"vrdisplaydisconnect\",(function(e){t.status,t.renderer.vr.enabled=!1,t.fire(\"disconnet\",t.device)}),!1),window.addEventListener(\"vrdisplaypresentchange\",(function(e){t.device=e.display||e.detail.display,t.fire(\"statuschange\",t.device)}),!1)}},{key:\"enterVR\",value:function(){this.device.requestPresent([{source:this.renderer.domElement}])}},{key:\"exitVR\",value:function(){this.device.exitPresent()}},{key:\"createButton\",value:function(t){var e=this;t||((t=document.createElement(\"button\")).style.position=\"absolute\",t.style.bottom=\"20px\",t.style.padding=\"12px 6px\",t.style.border=\"1px solid #fff\",t.style.borderRadius=\"4px\",t.style.background=\"transparent\",t.style.color=\"#fff\",t.style.textAlign=\"center\",t.style.opacity=\"0.5\",t.style.outline=\"none\",t.style.zIndex=\"9999\",t.style.cursor=\"auto\",t.style.left=\"calc(50% - 75px)\",t.style.width=\"150px\",t.textContent=\"Enter VR\",document.body.appendChild(t)),t.addEventListener(\"click\",(function(){e.device&&e.enterVR()}))}},{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.renderer=t.renderer,this.initVRRenderer()}},{key:\"initVRRenderer\",value:function(){}}]),e}(n(5).default)},function(t,e,n){\"use strict\";n.r(e);var i=n(0),a=n.n(i),o=n(1),r=n.n(o),s=n(2),c=n.n(s),u=n(3),h=n.n(u),l=n(4),p=n.n(l),d=function(t){function e(t){var n;return a()(this,e),(n=c()(this,h()(e).call(this,t))).lanePoints=[],n.initPoints(),n}return p()(e,t),r()(e,[{key:\"initPoints\",value:function(){this.material=new THREE.PointsMaterial({color:16777215,size:10}),this.pointsGeometry=new THREE.BufferGeometry,this.points=new THREE.Points(this.pointsGeometry,this.material)}},{key:\"onAdd\",value:function(t){this.pigeonMap=t,this.pigeonMap.world.add(this.points)}},{key:\"drawPoints\",value:function(t){this.baseLngLat=t[0],this.baseXYZ=this.pigeonMap.projectToWorld(this.baseLngLat);var e,n=[],i=[],a=[];for(var o in t)e=this.pigeonMap.projectToWorld(t[o]),n.push(e.x-this.baseXYZ.x,e.y-this.baseXYZ.y,e.z-this.baseXYZ.z),a.push(t[o]),i.push(o);this.points.geometry.addAttribute(\"position\",new THREE.Float32BufferAttribute(n,3)),this.points.geometry.computeBoundingSphere(),this.points.position.x=this.baseXYZ.x,this.points.position.y=this.baseXYZ.y,this.points.position.z=this.baseXYZ.z}}]),e}(n(5).default);e.default=d},function(t,e,n){\"use strict\";n.r(e),n.d(e,\"default\",(function(){return v}));var i=n(10),a=n.n(i),o=n(0),r=n.n(o),s=n(1),c=n.n(s),u=n(2),h=n.n(u),l=n(3),p=n.n(l),d=n(4),m=n.n(d),f=window.THREE,v=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"rgba(255, 255, 255, 1)\";return r()(this,e),(t=h()(this,p()(e).call(this,new f.SpriteMaterial({map:new f.Texture}))))._text=n,t._textHeight=i,t._color=a,t._fontFace=\"Arial\",t._fontSize=90,t._fontWeight=\"normal\",t._canvas=document.createElement(\"canvas\"),t._texture=t.material.map,t._texture.minFilter=f.LinearFilter,t._genCanvas(),t}return m()(e,t),c()(e,[{key:\"_genCanvas\",value:function(){var t=this,e=this._canvas,n=e.getContext(\"2d\"),i=this._text.split(\"\\n\");e.width=Math.max.apply(Math,a()(i.map((function(t){return n.measureText(t).width})))),e.height=this.fontSize*i.length,n.font=\"\".concat(this.fontWeight,\" \").concat(this.fontSize,\"px \").concat(this.fontFace),n.fillStyle=this.color,n.textBaseline=\"bottom\",i.forEach((function(i,a){return n.fillText(i,(e.width-n.measureText(i).width)/2,(a+1)*t.fontSize)})),this._texture.image=e,this._texture.needsUpdate=!0;var o=this.textHeight*i.length;this.scale.set(o*e.width/e.height,o)}},{key:\"clone\",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:\"copy\",value:function(t){return f.Sprite.prototype.copy.call(this,t),this.color=t.color,this.fontFace=t.fontFace,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this}},{key:\"text\",get:function(){return this._text},set:function(t){this._text=t,this._genCanvas()}},{key:\"textHeight\",get:function(){return this._textHeight},set:function(t){this._textHeight=t,this._genCanvas()}},{key:\"color\",get:function(){return this._color},set:function(t){this._color=t,this._genCanvas()}},{key:\"fontFace\",get:function(){return this._fontFace},set:function(t){this._fontFace=t,this._genCanvas()}},{key:\"fontSize\",get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._genCanvas()}},{key:\"fontWeight\",get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._genCanvas()}}]),e}(f.Sprite)},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||\"[object Arguments]\"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}}]).default}));","extractedComments":[]}